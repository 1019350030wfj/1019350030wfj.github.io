<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>è§†é¢‘å‰ªè¾‘å¼€å‘å®æˆ˜ï¼šä»åŠŸèƒ½åˆ—è¡¨åˆ°å®Œæ•´åº”ç”¨</title>
    <link href="/2025/12/19/multimedia/%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91.html"/>
    <url>/2025/12/19/multimedia/%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91.html</url>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯-é—®é¢˜"><a href="#èƒŒæ™¯-é—®é¢˜" class="headerlink" title="èƒŒæ™¯ &amp; é—®é¢˜"></a>èƒŒæ™¯ &amp; é—®é¢˜</h2><p>åœ¨ç§»åŠ¨ç«¯è§†é¢‘åº”ç”¨å¼€å‘ä¸­ï¼ŒåŠŸèƒ½è§„åˆ’å’ŒæŠ€æœ¯å®ç°å¾€å¾€é¢ä¸´ä»¥ä¸‹æŒ‘æˆ˜ï¼š</p><ul><li><strong>åŠŸèƒ½åˆ†æ•£</strong>ï¼šå„ç§å‰ªè¾‘åŠŸèƒ½ç¼ºä¹ç»Ÿä¸€çš„æ¶æ„è®¾è®¡</li><li><strong>ä»£ç å¤ç”¨æ€§ä½</strong>ï¼šç›¸ä¼¼åŠŸèƒ½é‡å¤å®ç°ï¼Œç»´æŠ¤æˆæœ¬é«˜</li><li><strong>æ€§èƒ½ç“¶é¢ˆ</strong>ï¼šè§†é¢‘å¤„ç†ç®—æ³•å®ç°ä¸å½“å¯¼è‡´å¡é¡¿</li><li><strong>å¼€å‘æ•ˆç‡ä½</strong>ï¼šç¼ºä¹æ ‡å‡†åŒ–çš„å¼€å‘æµç¨‹å’Œå·¥å…·é“¾</li></ul><p>æœ¬æ–‡åŸºäºå®é™…é¡¹ç›®ç»éªŒï¼Œæä¾›ä¸€å¥—å®Œæ•´çš„è§†é¢‘å‰ªè¾‘åº”ç”¨å¼€å‘æŒ‡å—ã€‚</p><h2 id="ç»“è®ºå…ˆè¡Œï¼ˆTL-DRï¼‰"><a href="#ç»“è®ºå…ˆè¡Œï¼ˆTL-DRï¼‰" class="headerlink" title="ç»“è®ºå…ˆè¡Œï¼ˆTL;DRï¼‰"></a>ç»“è®ºå…ˆè¡Œï¼ˆTL;DRï¼‰</h2><p>è§†é¢‘å‰ªè¾‘åº”ç”¨çš„æ ¸å¿ƒæ˜¯<strong>ç®¡é“åŒ–å¤„ç†æ¶æ„ + æ¨¡å—åŒ–åŠŸèƒ½è®¾è®¡</strong>ã€‚é€šè¿‡åˆç†çš„è®¾è®¡æ¨¡å¼å’Œç°ä»£æŠ€æœ¯æ ˆï¼Œå¯ä»¥å®ç°é«˜æ€§èƒ½ã€æ˜“ç»´æŠ¤çš„è§†é¢‘å¤„ç†åº”ç”¨ã€‚</p><p>å…³é”®è¦ç‚¹ï¼š</p><ul><li>ğŸ¯ <strong>æ¶æ„é€‰æ‹©</strong>ï¼šCommand&#x2F;Handler æ¨¡å¼ + Pipeline æ¶æ„</li><li>ğŸš€ <strong>æŠ€æœ¯æ ˆ</strong>ï¼šFFmpeg + OpenGL ES + Camera2D API</li><li>ğŸ“± <strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå¼‚æ­¥å¤„ç† + å†…å­˜æ±  + ç¡¬ä»¶åŠ é€Ÿ</li><li>ğŸ› ï¸ <strong>ä»£ç è´¨é‡</strong>ï¼šæ¨¡å—åŒ– + å•å…ƒæµ‹è¯• + ä¾èµ–æ³¨å…¥</li></ul><h2 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h2><h3 id="è§†é¢‘å¤„ç†ç®¡é“æ¶æ„"><a href="#è§†é¢‘å¤„ç†ç®¡é“æ¶æ„" class="headerlink" title="è§†é¢‘å¤„ç†ç®¡é“æ¶æ„"></a>è§†é¢‘å¤„ç†ç®¡é“æ¶æ„</h3><p>ç°ä»£è§†é¢‘å‰ªè¾‘åº”ç”¨çš„æ ¸å¿ƒæ˜¯<strong>å¤„ç†ç®¡é“ï¼ˆPipelineï¼‰</strong>ï¼Œæ¯ä¸ªå¤„ç†é˜¶æ®µéƒ½æ˜¯ç‹¬ç«‹çš„å¤„ç†å™¨ï¼š</p><pre class="line-numbers language- mermaid"><code class="language- mermaid">graph LR    A[è§†é¢‘æº] --> B[è§£ç å™¨]    B --> C[é¢„å¤„ç†]    C --> D[åŸºç¡€ç¼–è¾‘]    D --> E[ç‰¹æ•ˆå¤„ç†]    E --> F[é«˜çº§ç¼–è¾‘]    F --> G[ç¼–ç å™¨]    G --> H[è¾“å‡º]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="å…³é”®ç»„ä»¶è®¾è®¡"><a href="#å…³é”®ç»„ä»¶è®¾è®¡" class="headerlink" title="å…³é”®ç»„ä»¶è®¾è®¡"></a>å…³é”®ç»„ä»¶è®¾è®¡</h4><ol><li><p><strong>MediaExtractorï¼ˆåª’ä½“æå–å™¨ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MediaExtractor</span> &#123;<br>    VideoFrame <span class="hljs-title function_">extractFrame</span><span class="hljs-params">(String videoPath, <span class="hljs-type">long</span> timeUs)</span>;<br>    AudioTrack <span class="hljs-title function_">extractAudio</span><span class="hljs-params">(String videoPath)</span>;<br>    MediaMetadata <span class="hljs-title function_">extractMetadata</span><span class="hljs-params">(String videoPath)</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FFmpegMediaExtractor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MediaExtractor</span> &#123;<br>    <span class="hljs-keyword">private</span> FFmpeg ffmpeg;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> VideoFrame <span class="hljs-title function_">extractFrame</span><span class="hljs-params">(String videoPath, <span class="hljs-type">long</span> timeUs)</span> &#123;<br>        <span class="hljs-comment">// ä½¿ç”¨ FFmpeg æå–æŒ‡å®šæ—¶é—´çš„è§†é¢‘å¸§</span><br>        <span class="hljs-keyword">return</span> ffmpeg.extractFrame(videoPath, timeUs);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> AudioTrack <span class="hljs-title function_">extractAudio</span><span class="hljs-params">(String videoPath)</span> &#123;<br>        <span class="hljs-comment">// æå–éŸ³é¢‘è½¨é“</span><br>        <span class="hljs-keyword">return</span> ffmpeg.extractAudio(videoPath);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> MediaMetadata <span class="hljs-title function_">extractMetadata</span><span class="hljs-params">(String videoPath)</span> &#123;<br>        <span class="hljs-comment">// æå–è§†é¢‘å…ƒä¿¡æ¯</span><br>        <span class="hljs-keyword"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MediaExtractor</span> &#123;<br>    VideoFrame <span class="hljs-title function_">extractFrame</span><span class="hljs-params">(String videoPath, <span class="hljs-type">long</span> timeUs)</span>;<br>    AudioTrack <span class="hljs-title function_">extractAudio</span><span class="hljs-params">(String videoPath)</span>;<br>    MediaMetadata <span class="hljs-title function_">extractMetadata</span><span class="hljs-params">(String videoPath)</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FFmpegMediaExtractor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MediaExtractor</span> &#123;<br>    <span class="hljs-keyword">private</span> FFmpeg ffmpeg;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> VideoFrame <span class="hljs-title function_">extractFrame</span><span class="hljs-params">(String videoPath, <span class="hljs-type">long</span> timeUs)</span> &#123;<br>        <span class="hljs-comment">// ä½¿ç”¨ FFmpeg æå–æŒ‡å®šæ—¶é—´çš„è§†é¢‘å¸§</span><br>        <span class="hljs-keyword">return</span> ffmpeg.extractFrame(videoPath, timeUs);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> AudioTrack <span class="hljs-title function_">extractAudio</span><span class="hljs-params">(String videoPath)</span> &#123;<br>        <span class="hljs-comment">// æå–éŸ³é¢‘è½¨é“</span><br>        <span class="hljs-keyword">return</span> ffmpeg.extractAudio(videoPath);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> MediaMetadata <span class="hljs-title function_">extractMetadata</span><span class="hljs-params">(String videoPath)</span> &#123;<br>        <span class="hljs-comment">// æå–è§†é¢‘å…ƒä¿¡æ¯</span><br>        <span class="hljs-keyword">return</span> ffmpeg.getMetadata(videoPath);<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure></li><li><p><strong>VideoProcessorï¼ˆè§†é¢‘å¤„ç†å™¨ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">VideoProcessor</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyFilter</span><span class="hljs-params">(VideoFrame frame, Filter filter)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyTransition</span><span class="hljs-params">(VideoFrame from, VideoFrame to, Transition transition)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">adjustSpeed</span><span class="hljs-params">(MediaTrack track, <span class="hljs-type">float</span> speed)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyEffect</span><span class="hljs-params">(VideoFrame frame, Effect effect)</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OpenGLVideoProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">VideoProcessor</span> &#123;<br>    <span class="hljs-keyword">private</span> EGLContext eglContext;<br>    <span class="hljs-keyword">private</span> ShaderProgram shaderProgram;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyFilter</span><span class="hljs-params">(VideoFrame frame, Filter filter)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (filter.getType()) &#123;<br>            <span class="hljs-keyword">case</span> COLOR_GRADIENT:<br>                applyColorGradient(frame, (ColorGradientFilter) filter);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> GAUSSIAN_BLUR:<br>                applyGaussianBlur(frame, (GaussianBlurFilter) filter);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-comment">// ... å…¶ä»–æ»¤é•œå®ç°</span><br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyColorGradient</span><span class="hljs-params">(VideoFrame frame, ColorGradientFilter filter)</span> &#123;<br>        <span class="hljs-comment"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">VideoProcessor</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyFilter</span><span class="hljs-params">(VideoFrame frame, Filter filter)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyTransition</span><span class="hljs-params">(VideoFrame from, VideoFrame to, Transition transition)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">adjustSpeed</span><span class="hljs-params">(MediaTrack track, <span class="hljs-type">float</span> speed)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyEffect</span><span class="hljs-params">(VideoFrame frame, Effect effect)</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OpenGLVideoProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">VideoProcessor</span> &#123;<br>    <span class="hljs-keyword">private</span> EGLContext eglContext;<br>    <span class="hljs-keyword">private</span> ShaderProgram shaderProgram;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyFilter</span><span class="hljs-params">(VideoFrame frame, Filter filter)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (filter.getType()) &#123;<br>            <span class="hljs-keyword">case</span> COLOR_GRADIENT:<br>                applyColorGradient(frame, (ColorGradientFilter) filter);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> GAUSSIAN_BLUR:<br>                applyGaussianBlur(frame, (GaussianBlurFilter) filter);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-comment">// ... å…¶ä»–æ»¤é•œå®ç°</span><br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyColorGradient</span><span class="hljs-params">(VideoFrame frame, ColorGradientFilter filter)</span> &#123;<br>        <span class="hljs-comment">// ä½¿ç”¨ OpenGL ES ç€è‰²å™¨å®ç°æ¸å˜æ•ˆæœ</span><br>        bindShader(filter.getShaderSource());<br>        renderFrameWithFilter(frame, filter.getParameters());<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure></li><li><p><strong>EffectComposerï¼ˆç‰¹æ•ˆåˆæˆå™¨ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EffectComposer</span> &#123;<br>    <span class="hljs-keyword">public</span> Composition <span class="hljs-title function_">compose</span><span class="hljs-params">(List&lt;MediaTrack&gt; tracks, CompositionSettings settings)</span> &#123;<br>        <span class="hljs-type">Timeline</span> <span class="hljs-variable">timeline</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Timeline</span>();<br>        <br>        <span class="hljs-comment">// æ·»åŠ è§†é¢‘è½¨é“</span><br>        <span class="hljs-keyword">for</span> (MediaTrack track : tracks) &#123;<br>            timeline.addTrack(track);<br>        &#125;<br>        <br>        <span class="hljs-comment">// æ·»åŠ è½¬åœºæ•ˆæœ</span><br>        <span class="hljs-keyword">if</span> (settings.hasTransitions()) &#123;<br>            addTransitions(timeline, settings.getTransitions());<br>        &#125;<br>        <br>        <span class="hljs-comment">// æ·»åŠ å åŠ å±‚</span><br>        <span class="hljs-keyword">if</span> (settings.hasOverlays()) &#123;<br>            addOverlays(timeline, settings.getOverlays());<br>        &#125;<br>        <br>        <span class="hljs-keyword"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EffectComposer</span> &#123;<br>    <span class="hljs-keyword">public</span> Composition <span class="hljs-title function_">compose</span><span class="hljs-params">(List&lt;MediaTrack&gt; tracks, CompositionSettings settings)</span> &#123;<br>        <span class="hljs-type">Timeline</span> <span class="hljs-variable">timeline</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Timeline</span>();<br>        <br>        <span class="hljs-comment">// æ·»åŠ è§†é¢‘è½¨é“</span><br>        <span class="hljs-keyword">for</span> (MediaTrack track : tracks) &#123;<br>            timeline.addTrack(track);<br>        &#125;<br>        <br>        <span class="hljs-comment">// æ·»åŠ è½¬åœºæ•ˆæœ</span><br>        <span class="hljs-keyword">if</span> (settings.hasTransitions()) &#123;<br>            addTransitions(timeline, settings.getTransitions());<br>        &#125;<br>        <br>        <span class="hljs-comment">// æ·»åŠ å åŠ å±‚</span><br>        <span class="hljs-keyword">if</span> (settings.hasOverlays()) &#123;<br>            addOverlays(timeline, settings.getOverlays());<br>        &#125;<br>        <br>        <span class="hljs-keyword">return</span> timeline.render();<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure></li><li><p><strong>MediaEncoderï¼ˆåª’ä½“ç¼–ç å™¨ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">H264Encoder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MediaEncoder</span> &#123;<br>    <span class="hljs-keyword">private</span> MediaCodec mediaCodec;<br>    <span class="hljs-keyword">private</span> MediaFormat mediaFormat;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">encodeVideo</span><span class="hljs-params">(VideoFrame[] frames, String outputPath)</span> &#123;<br>        <span class="hljs-type">MediaFormat</span> <span class="hljs-variable">format</span> <span class="hljs-operator">=</span> MediaFormat.createVideoFormat(MediaFormat.MIMETYPE_VIDEO_AVC, <br>                videoWidth, videoHeight, frameRate, <span class="hljs-literal">null</span>);<br>        mediaCodec = MediaCodec.createEncoderByType(format, <span class="hljs-literal">null</span>);<br>        <br>        mediaCodec.configure(format, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>        <br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(outputPath)) &#123;<br>            <span class="hljs-keyword">for</span> (VideoFrame frame : frames) &#123;<br>                mediaCodec.queueInputBuffer(frame.getBuffer());<br>                <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">outputBuffer</span> <span class="hljs-operator">=</span> mediaCodec.getOutputBuffer();<br>                <br>                <span class="hljs-keyword">while</span> (mediaCodec.dequeueOutputBuffer(outputBuffer, <span class="hljs-literal">true</span>) &gt;= <span class="hljs-number">0</span>) &#123;<br>                    fos.write(outputBuffer.array());<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">H264Encoder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MediaEncoder</span> &#123;<br>    <span class="hljs-keyword">private</span> MediaCodec mediaCodec;<br>    <span class="hljs-keyword">private</span> MediaFormat mediaFormat;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">encodeVideo</span><span class="hljs-params">(VideoFrame[] frames, String outputPath)</span> &#123;<br>        <span class="hljs-type">MediaFormat</span> <span class="hljs-variable">format</span> <span class="hljs-operator">=</span> MediaFormat.createVideoFormat(MediaFormat.MIMETYPE_VIDEO_AVC, <br>                videoWidth, videoHeight, frameRate, <span class="hljs-literal">null</span>);<br>        mediaCodec = MediaCodec.createEncoderByType(format, <span class="hljs-literal">null</span>);<br>        <br>        mediaCodec.configure(format, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>        <br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(outputPath)) &#123;<br>            <span class="hljs-keyword">for</span> (VideoFrame frame : frames) &#123;<br>                mediaCodec.queueInputBuffer(frame.getBuffer());<br>                <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">outputBuffer</span> <span class="hljs-operator">=</span> mediaCodec.getOutputBuffer();<br>                <br>                <span class="hljs-keyword">while</span> (mediaCodec.dequeueOutputBuffer(outputBuffer, <span class="hljs-literal">true</span>) &gt;= <span class="hljs-number">0</span>) &#123;<br>                    fos.write(outputBuffer.array());<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            mediaCodec.stop();<br>            mediaCodec.release();<br>        &#125;<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure></li></ol><h2 id="å®ç°æ–¹æ¡ˆ"><a href="#å®ç°æ–¹æ¡ˆ" class="headerlink" title="å®ç°æ–¹æ¡ˆ"></a>å®ç°æ–¹æ¡ˆ</h2><h3 id="1-é¡¹ç›®æ¶æ„è®¾è®¡"><a href="#1-é¡¹ç›®æ¶æ„è®¾è®¡" class="headerlink" title="1. é¡¹ç›®æ¶æ„è®¾è®¡"></a>1. é¡¹ç›®æ¶æ„è®¾è®¡</h3><h4 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a>æ•´ä½“æ¶æ„</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoEditorApplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Application</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate();<br>        initializeDI();<br>        initVideoProcessingPipeline();<br>        initUI();<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initializeDI</span><span class="hljs-params">()</span> &#123;<br>        DaggerApplicationComponent.builder()<br>            .application(<span class="hljs-built_in">this</span>)<br>            .build()<br>            .inject(<span class="hljs-built_in">this</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initVideoProcessingPipeline</span><span class="hljs-params"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoEditorApplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Application</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate();<br>        initializeDI();<br>        initVideoProcessingPipeline();<br>        initUI();<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initializeDI</span><span class="hljs-params">()</span> &#123;<br>        DaggerApplicationComponent.builder()<br>            .application(<span class="hljs-built_in">this</span>)<br>            .build()<br>            .inject(<span class="hljs-built_in">this</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initVideoProcessingPipeline</span><span class="hljs-params">()</span> &#123;<br>        videoProcessingPipeline = videoEditorComponent.getVideoProcessingPipeline();<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h4 id="ä¾èµ–æ³¨å…¥é…ç½®"><a href="#ä¾èµ–æ³¨å…¥é…ç½®" class="headerlink" title="ä¾èµ–æ³¨å…¥é…ç½®"></a>ä¾èµ–æ³¨å…¥é…ç½®</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-meta">@Module</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoProcessingModule</span> &#123;<br>    <span class="hljs-meta">@Provides</span><br>    <span class="hljs-meta">@Singleton</span><br>    <span class="hljs-keyword">public</span> MediaExtractor <span class="hljs-title function_">provideMediaExtractor</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FFmpegMediaExtractor</span>();<br>    &#125;<br>    <br>    <span class="hljs-meta">@Provides</span><br>    <span class="hljs-meta">@Singleton</span><br>    <span class="hljs-keyword">public</span> VideoProcessor <span class="hljs-title function_">provideVideoProcessor</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenGLVideoProcessor</span>();<br>    &#125;<br>    <br>    <span class="hljs-meta">@Provides</span><br>    <span class="hljs-meta">@Singleton</span><br>    <span class="hljs-keyword">public</span> EffectComposer <span class="hljs-title function_">provideEffectComposer</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EffectComposer</span>();<br>    &#125;<br>    <br>    <span class="hljs-meta">@Provides</span><br>    <span class="hljs-meta">@Singleton</span><br>    <span class="hljs-keyword">public</span> MediaEncoder <span class="hljs-title function_">provideMediaEncoder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_"><code class="language-hljs java"><span class="hljs-meta">@Module</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoProcessingModule</span> &#123;<br>    <span class="hljs-meta">@Provides</span><br>    <span class="hljs-meta">@Singleton</span><br>    <span class="hljs-keyword">public</span> MediaExtractor <span class="hljs-title function_">provideMediaExtractor</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FFmpegMediaExtractor</span>();<br>    &#125;<br>    <br>    <span class="hljs-meta">@Provides</span><br>    <span class="hljs-meta">@Singleton</span><br>    <span class="hljs-keyword">public</span> VideoProcessor <span class="hljs-title function_">provideVideoProcessor</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenGLVideoProcessor</span>();<br>    &#125;<br>    <br>    <span class="hljs-meta">@Provides</span><br>    <span class="hljs-meta">@Singleton</span><br>    <span class="hljs-keyword">public</span> EffectComposer <span class="hljs-title function_">provideEffectComposer</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EffectComposer</span>();<br>    &#125;<br>    <br>    <span class="hljs-meta">@Provides</span><br>    <span class="hljs-meta">@Singleton</span><br>    <span class="hljs-keyword">public</span> MediaEncoder <span class="hljs-title function_">provideMediaEncoder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">H264Encoder</span>();<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="2-æ ¸å¿ƒåŠŸèƒ½å®ç°"><a href="#2-æ ¸å¿ƒåŠŸèƒ½å®ç°" class="headerlink" title="2. æ ¸å¿ƒåŠŸèƒ½å®ç°"></a>2. æ ¸å¿ƒåŠŸèƒ½å®ç°</h3><h4 id="é«˜çº§å‰ªè¾‘åŠŸèƒ½"><a href="#é«˜çº§å‰ªè¾‘åŠŸèƒ½" class="headerlink" title="é«˜çº§å‰ªè¾‘åŠŸèƒ½"></a>é«˜çº§å‰ªè¾‘åŠŸèƒ½</h4><p><img src="/2025/12/19/multimedia/%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91/%E9%AB%98%E7%BA%A7%E5%89%AA%E8%BE%91.png" alt="é«˜çº§å‰ªè¾‘"></p><p><strong>å¤šè½¨é“æ—¶é—´è½´ç¼–è¾‘</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimelineEditor</span> &#123;<br>    <span class="hljs-keyword">private</span> List&lt;VideoTrack&gt; tracks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> Timeline timeline;<br>    <span class="hljs-keyword">private</span> Selection selection;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addVideoTrack</span><span class="hljs-params">(String videoPath)</span> &#123;<br>        <span class="hljs-type">MediaExtractor</span> <span class="hljs-variable">extractor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FFmpegMediaExtractor</span>();<br>        <span class="hljs-type">MediaTrack</span> <span class="hljs-variable">track</span> <span class="hljs-operator">=</span> extractor.extractVideoTrack(videoPath);<br>        tracks.add(track);<br>        timeline.addTrack(track);<br>        notifyTimelineChanged();<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">splitTrackAt</span><span class="hljs-params">(VideoTrack track, <span class="hljs-type">long</span> timeUs)</span> &#123;<br>        <span class="hljs-type">VideoTrack</span> <span class="hljs-variable">newTrack</span> <span class="hljs-operator">=</span> track.splitAt(timeUs);<br>        tracks.add(tracks.indexOf(track), newTrack);<br>        timeline.addTrack(newTrack);<br>        notifyTimelineChanged();<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyTransition</span><span class="hljs-params">(Transition transition)</span> &#123;<br>        <span class="hljs-keyword">if</span> (selection.getDuration() &gt; transition.getDuration()) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Transition longer than selection&quot;</span>);<br>        &#125;<br>        <br>        <span class="hljs-comment"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimelineEditor</span> &#123;<br>    <span class="hljs-keyword">private</span> List&lt;VideoTrack&gt; tracks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> Timeline timeline;<br>    <span class="hljs-keyword">private</span> Selection selection;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addVideoTrack</span><span class="hljs-params">(String videoPath)</span> &#123;<br>        <span class="hljs-type">MediaExtractor</span> <span class="hljs-variable">extractor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FFmpegMediaExtractor</span>();<br>        <span class="hljs-type">MediaTrack</span> <span class="hljs-variable">track</span> <span class="hljs-operator">=</span> extractor.extractVideoTrack(videoPath);<br>        tracks.add(track);<br>        timeline.addTrack(track);<br>        notifyTimelineChanged();<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">splitTrackAt</span><span class="hljs-params">(VideoTrack track, <span class="hljs-type">long</span> timeUs)</span> &#123;<br>        <span class="hljs-type">VideoTrack</span> <span class="hljs-variable">newTrack</span> <span class="hljs-operator">=</span> track.splitAt(timeUs);<br>        tracks.add(tracks.indexOf(track), newTrack);<br>        timeline.addTrack(newTrack);<br>        notifyTimelineChanged();<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyTransition</span><span class="hljs-params">(Transition transition)</span> &#123;<br>        <span class="hljs-keyword">if</span> (selection.getDuration() &gt; transition.getDuration()) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Transition longer than selection&quot;</span>);<br>        &#125;<br>        <br>        <span class="hljs-comment">// è‡ªåŠ¨å¤„ç†ä¸è½¬åœºé€‚é…çš„æ—¶é—´è½´</span><br>        selection.applyTransition(transition);<br>        notifyTimelineChanged();<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p><img src="/2025/12/19/multimedia/%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91/%E9%AB%98%E7%BA%A7%E7%BE%8E%E5%AE%B9.png" alt="é«˜çº§ç¾å®¹"></p><p><strong>é«˜çº§ç¾å®¹åŠŸèƒ½</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BeautyFilterProcessor</span> &#123;<br>    <span class="hljs-keyword">private</span> GPUImageProcessor gpuProcessor;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyBeautyEffects</span><span class="hljs-params">(VideoFrame frame, BeautySettings settings)</span> &#123;<br>        <span class="hljs-comment">// ç¾ç™½ç®—æ³•</span><br>        <span class="hljs-type">VideoFrame</span> <span class="hljs-variable">whitened</span> <span class="hljs-operator">=</span> applySkinWhitening(frame, settings.getWhiteningLevel());<br>        <br>        <span class="hljs-comment">// ç£¨çš®å¹³æ»‘</span><br>        <span class="hljs-type">VideoFrame</span> <span class="hljs-variable">smoothed</span> <span class="hljs-operator">=</span> applySkinSmoothing(whitened, settings.getSmoothingLevel());<br>        <br>        <span class="hljs-comment">// å¤§çœ¼æ•ˆæœ</span><br>        <span class="hljs-type">VideoFrame</span> <span class="hljs-variable">enlarged</span> <span class="hljs-operator">=</span> applyEyeEnlargement(smoothed, settings.getEyeEnlargementLevel());<br>        <br>        <span class="hljs-comment">// ç˜¦è„¸æ•ˆæœ</span><br>        <span class="hljs-type">VideoFrame</span> <span class="hljs-variable">thinned</span> <span class="hljs-operator">=</span> applyFaceThinning(enlarged, settings.getThinningLevel());<br>        <br>        gpuProcessor.processFrame(thinned);<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> VideoFrame <span class="hljs-title function_">applySkinWhitening</span><span class="hljs-params">(VideoFrame frame, <span class="hljs-type">float</span> level)</span> &#123;<br>        <span class="hljs-comment">// åŸºäº YUV é¢œè‰²ç©ºé—´çš„çš®è‚¤æ£€æµ‹å’Œç¾ç™½ç®—æ³•</span><br>        <span class="hljs-type">YUVFrame</span> <span class="hljs-variable">yuvFrame</span> <span class="hljs-operator">=</span> convertToYUV(frame);<br>        <span class="hljs-type">byte</span>[] whitened = yuvFrame.clone();<br>        applyWhiteningAlgorithm(whitened, level);<br>        <span class="hljs-keyword"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BeautyFilterProcessor</span> &#123;<br>    <span class="hljs-keyword">private</span> GPUImageProcessor gpuProcessor;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyBeautyEffects</span><span class="hljs-params">(VideoFrame frame, BeautySettings settings)</span> &#123;<br>        <span class="hljs-comment">// ç¾ç™½ç®—æ³•</span><br>        <span class="hljs-type">VideoFrame</span> <span class="hljs-variable">whitened</span> <span class="hljs-operator">=</span> applySkinWhitening(frame, settings.getWhiteningLevel());<br>        <br>        <span class="hljs-comment">// ç£¨çš®å¹³æ»‘</span><br>        <span class="hljs-type">VideoFrame</span> <span class="hljs-variable">smoothed</span> <span class="hljs-operator">=</span> applySkinSmoothing(whitened, settings.getSmoothingLevel());<br>        <br>        <span class="hljs-comment">// å¤§çœ¼æ•ˆæœ</span><br>        <span class="hljs-type">VideoFrame</span> <span class="hljs-variable">enlarged</span> <span class="hljs-operator">=</span> applyEyeEnlargement(smoothed, settings.getEyeEnlargementLevel());<br>        <br>        <span class="hljs-comment">// ç˜¦è„¸æ•ˆæœ</span><br>        <span class="hljs-type">VideoFrame</span> <span class="hljs-variable">thinned</span> <span class="hljs-operator">=</span> applyFaceThinning(enlarged, settings.getThinningLevel());<br>        <br>        gpuProcessor.processFrame(thinned);<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> VideoFrame <span class="hljs-title function_">applySkinWhitening</span><span class="hljs-params">(VideoFrame frame, <span class="hljs-type">float</span> level)</span> &#123;<br>        <span class="hljs-comment">// åŸºäº YUV é¢œè‰²ç©ºé—´çš„çš®è‚¤æ£€æµ‹å’Œç¾ç™½ç®—æ³•</span><br>        <span class="hljs-type">YUVFrame</span> <span class="hljs-variable">yuvFrame</span> <span class="hljs-operator">=</span> convertToYUV(frame);<br>        <span class="hljs-type">byte</span>[] whitened = yuvFrame.clone();<br>        applyWhiteningAlgorithm(whitened, level);<br>        <span class="hljs-keyword">return</span> convertFromYUV(whitened);<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><p><img src="/2025/12/19/multimedia/%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91/%E5%9F%BA%E7%A1%80%E5%89%AA%E8%BE%91.png" alt="åŸºç¡€å‰ªè¾‘"><br><img src="/2025/12/19/multimedia/%E8%A7%86%E9%A2%91%E5%89%AA%E8%BE%91/%E5%9F%BA%E7%A1%80%E7%BE%8E%E5%AE%B9.png" alt="åŸºç¡€ç¾å®¹"></p><h3 id="3-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"><a href="#3-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="3. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"></a>3. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</h3><h4 id="å†…å­˜ç®¡ç†"><a href="#å†…å­˜ç®¡ç†" class="headerlink" title="å†…å­˜ç®¡ç†"></a>å†…å­˜ç®¡ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoFramePool</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Queue&lt;VideoFrame&gt; availableFrames = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">maxPoolSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span>;<br>    <br>    <span class="hljs-keyword">public</span> VideoFrame <span class="hljs-title function_">obtain</span><span class="hljs-params">(<span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (availableFrames) &#123;<br>            <span class="hljs-type">VideoFrame</span> <span class="hljs-variable">frame</span> <span class="hljs-operator">=</span> availableFrames.poll();<br>            <span class="hljs-keyword">if</span> (frame == <span class="hljs-literal">null</span> || !isValidSize(frame, width, height)) &#123;<br>                frame = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VideoFrame</span>(width, height);<br>            &#125;<br>            <span class="hljs-keyword">return</span> frame;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recycle</span><span class="hljs-params">(VideoFrame frame)</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (availableFrames) &#123;<br>            <span class="hljs-keyword"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoFramePool</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Queue&lt;VideoFrame&gt; availableFrames = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">maxPoolSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span>;<br>    <br>    <span class="hljs-keyword">public</span> VideoFrame <span class="hljs-title function_">obtain</span><span class="hljs-params">(<span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (availableFrames) &#123;<br>            <span class="hljs-type">VideoFrame</span> <span class="hljs-variable">frame</span> <span class="hljs-operator">=</span> availableFrames.poll();<br>            <span class="hljs-keyword">if</span> (frame == <span class="hljs-literal">null</span> || !isValidSize(frame, width, height)) &#123;<br>                frame = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VideoFrame</span>(width, height);<br>            &#125;<br>            <span class="hljs-keyword">return</span> frame;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recycle</span><span class="hljs-params">(VideoFrame frame)</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (availableFrames) &#123;<br>            <span class="hljs-keyword">if</span> (availableFrames.size() < maxPoolSize) &#123;<br>                availableFrames.offer(frame);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h4 id="å¼‚æ­¥å¤„ç†"><a href="#å¼‚æ­¥å¤„ç†" class="headerlink" title="å¼‚æ­¥å¤„ç†"></a>å¼‚æ­¥å¤„ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncVideoProcessor</span> &#123;<br>    <span class="hljs-keyword">private</span> ExecutorService executor;<br>    <span class="hljs-keyword">private</span> Handler mainHandler;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processVideoAsync</span><span class="hljs-params">(VideoData data, ProcessCallback callback)</span> &#123;<br>        executor.submit(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">VideoFrame</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> processVideoSync(data);<br>                mainHandler.post(() -&gt; callback.onSuccess(result));<br>            &#125; <span class="hljs-keyword"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncVideoProcessor</span> &#123;<br>    <span class="hljs-keyword">private</span> ExecutorService executor;<br>    <span class="hljs-keyword">private</span> Handler mainHandler;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processVideoAsync</span><span class="hljs-params">(VideoData data, ProcessCallback callback)</span> &#123;<br>        executor.submit(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">VideoFrame</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> processVideoSync(data);<br>                mainHandler.post(() -&gt; callback.onSuccess(result));<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                mainHandler.post(() -> callback.onError(e));<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="æ ¸å¿ƒä»£ç "><a href="#æ ¸å¿ƒä»£ç " class="headerlink" title="æ ¸å¿ƒä»£ç "></a>æ ¸å¿ƒä»£ç </h2><h3 id="è§†é¢‘æ¸²æŸ“å¼•æ“"><a href="#è§†é¢‘æ¸²æŸ“å¼•æ“" class="headerlink" title="è§†é¢‘æ¸²æŸ“å¼•æ“"></a>è§†é¢‘æ¸²æŸ“å¼•æ“</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OpenGLRenderer</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">VERTEX_SHADER</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        #version 300 es</span><br><span class="hljs-string">        precision mediump float;</span><br><span class="hljs-string">        layout(location = 0) in vec2 position;</span><br><span class="hljs-string">        attribute vec4 a_color;</span><br><span class="hljs-string">        varying vec2 v_texCoord;</span><br><span class="hljs-string">        uniform sampler2D s_texture;</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        void main() &#123;</span><br><span class="hljs-string">            vec4 color = texture2D(s_texture, v_texCoord);</span><br><span class="hljs-string">            gl_FragColor = vec4(color.rgb * color.a, color.a);</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &quot;&quot;&quot;</span>;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FRAGMENT_SHADER</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        precision mediump float;</span><br><span class="hljs-string">        varying vec4 v_color;</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        void main() &#123;</span><br><span class="hljs-string">            gl_FragColor = v_color;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &quot;&quot;`;</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    public void initShader() &#123;</span><br><span class="hljs-string">        int vertexShader = loadShader(GLES20.GL_VERTEX_SHADER, VERTEX_SHADER);</span><br><span class="hljs-string">        int fragmentShader = loadShader(GLES20.GL_FRAGMENT_SHADER, FRAGMENT_SHADER);</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        program = GLES20.glCreateProgram();</span><br><span class="hljs-string">        GLES20.glAttachShader(program, vertexShader);</span><br><span class="hljs-string">        GLES20.glAttachShader(program, fragmentShader);</span><br><span class="hljs-string">        GLES20.glLinkProgram(program);</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OpenGLRenderer</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">VERTEX_SHADER</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        #version 300 es</span><br><span class="hljs-string">        precision mediump float;</span><br><span class="hljs-string">        layout(location = 0) in vec2 position;</span><br><span class="hljs-string">        attribute vec4 a_color;</span><br><span class="hljs-string">        varying vec2 v_texCoord;</span><br><span class="hljs-string">        uniform sampler2D s_texture;</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        void main() &#123;</span><br><span class="hljs-string">            vec4 color = texture2D(s_texture, v_texCoord);</span><br><span class="hljs-string">            gl_FragColor = vec4(color.rgb * color.a, color.a);</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &quot;&quot;&quot;</span>;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FRAGMENT_SHADER</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        precision mediump float;</span><br><span class="hljs-string">        varying vec4 v_color;</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        void main() &#123;</span><br><span class="hljs-string">            gl_FragColor = v_color;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &quot;&quot;`;</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    public void initShader() &#123;</span><br><span class="hljs-string">        int vertexShader = loadShader(GLES20.GL_VERTEX_SHADER, VERTEX_SHADER);</span><br><span class="hljs-string">        int fragmentShader = loadShader(GLES20.GL_FRAGMENT_SHADER, FRAGMENT_SHADER);</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        program = GLES20.glCreateProgram();</span><br><span class="hljs-string">        GLES20.glAttachShader(program, vertexShader);</span><br><span class="hljs-string">        GLES20.glAttachShader(program, fragmentShader);</span><br><span class="hljs-string">        GLES20.glLinkProgram(program);</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">&#125;</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="FFmpeg-é›†æˆ"><a href="#FFmpeg-é›†æˆ" class="headerlink" title="FFmpeg é›†æˆ"></a>FFmpeg é›†æˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FFmpegBridge</span> &#123;<br>    <span class="hljs-keyword">static</span> &#123;<br>        System.loadLibrary(<span class="hljs-string">&quot;avcodec&quot;</span>);<br>        System.loadLibrary(<span class="hljs-string">&quot;avformat&quot;</span>);<br>        System.loadLibrary(<span class="hljs-string">&quot;avutil&quot;</span>);<br>        System.loadLibrary(<span class="hljs-string">&quot;swresample&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">extractVideoFrame</span><span class="hljs-params">(String videoPath, <span class="hljs-type">long</span> timeUs, <span class="hljs-type">byte</span>[] output)</span>;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">trimVideo</span><span class="hljs-params">(String inputPath, String outputPath, <span class="hljs-type">long</span> startTime, <span class="hljs-type">long</span> endTime)</span>;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">extractAudio</span><span class="hljs-params">(String videoPath, String outputPath)</span>;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyFilter</span><span class="hljs-params">(String inputPath, String filterName, <span class="hljs-type"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FFmpegBridge</span> &#123;<br>    <span class="hljs-keyword">static</span> &#123;<br>        System.loadLibrary(<span class="hljs-string">&quot;avcodec&quot;</span>);<br>        System.loadLibrary(<span class="hljs-string">&quot;avformat&quot;</span>);<br>        System.loadLibrary(<span class="hljs-string">&quot;avutil&quot;</span>);<br>        System.loadLibrary(<span class="hljs-string">&quot;swresample&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">extractVideoFrame</span><span class="hljs-params">(String videoPath, <span class="hljs-type">long</span> timeUs, <span class="hljs-type">byte</span>[] output)</span>;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">trimVideo</span><span class="hljs-params">(String inputPath, String outputPath, <span class="hljs-type">long</span> startTime, <span class="hljs-type">long</span> endTime)</span>;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">extractAudio</span><span class="hljs-params">(String videoPath, String outputPath)</span>;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyFilter</span><span class="hljs-params">(String inputPath, String filterName, <span class="hljs-type">float</span>[] parameters)</span>;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="å¸¸è§å‘ä¸è§£å†³æ–¹æ¡ˆ"><a href="#å¸¸è§å‘ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¸¸è§å‘ä¸è§£å†³æ–¹æ¡ˆ"></a>å¸¸è§å‘ä¸è§£å†³æ–¹æ¡ˆ</h2><h3 id="1-å†…å­˜æ³„æ¼"><a href="#1-å†…å­˜æ³„æ¼" class="headerlink" title="1. å†…å­˜æ³„æ¼"></a>1. å†…å­˜æ³„æ¼</h3><p><strong>é—®é¢˜</strong>ï¼šå¼‚æ­¥ä»»åŠ¡æŒæœ‰ Activity å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoProcessingTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AsyncTask</span>&lt;VideoData, Void, ProcessedData&gt; &#123;<br>    <span class="hljs-keyword">private</span> WeakReference&lt;Context&gt; contextRef;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">VideoProcessingTask</span><span class="hljs-params">(Context context)</span> &#123;<br>        contextRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(context);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> ProcessedData <span class="hljs-title function_">doInBackground</span><span class="hljs-params">(VideoData... params)</span> &#123;<br>        <span class="hljs-comment">// ä½¿ç”¨å¼±å¼•ç”¨é¿å…å†…å­˜æ³„æ¼</span><br>        <span class="hljs-type">Context</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> contextRef.get();<br>        <span class="hljs-keyword">if</span> (context == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        <br>        <span class="hljs-keyword">return</span> processVideoData(params);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPostExecute</span><span class="hljs-params">(ProcessedData result)</span> &#123;<br>        <span class="hljs-type">Context</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> contextRef.get();<br>        <span class="hljs-keyword">if</span> (context != <span class="hljs-literal"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoProcessingTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AsyncTask</span>&lt;VideoData, Void, ProcessedData&gt; &#123;<br>    <span class="hljs-keyword">private</span> WeakReference&lt;Context&gt; contextRef;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">VideoProcessingTask</span><span class="hljs-params">(Context context)</span> &#123;<br>        contextRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(context);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> ProcessedData <span class="hljs-title function_">doInBackground</span><span class="hljs-params">(VideoData... params)</span> &#123;<br>        <span class="hljs-comment">// ä½¿ç”¨å¼±å¼•ç”¨é¿å…å†…å­˜æ³„æ¼</span><br>        <span class="hljs-type">Context</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> contextRef.get();<br>        <span class="hljs-keyword">if</span> (context == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        <br>        <span class="hljs-keyword">return</span> processVideoData(params);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPostExecute</span><span class="hljs-params">(ProcessedData result)</span> &#123;<br>        <span class="hljs-type">Context</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> contextRef.get();<br>        <span class="hljs-keyword">if</span> (context != <span class="hljs-literal">null</span>) &#123;<br>            updateUI(result);<br>        &#125;<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="2-ANR-é”™è¯¯"><a href="#2-ANR-é”™è¯¯" class="headerlink" title="2. ANR é”™è¯¯"></a>2. ANR é”™è¯¯</h3><p><strong>é—®é¢˜</strong>ï¼šä¸»çº¿ç¨‹é˜»å¡å¯¼è‡´ ANR</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeVideoProcessor</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processVideoOnMainThread</span><span class="hljs-params">(VideoData data, ProcessCallback callback)</span> &#123;<br>        <span class="hljs-comment">// ç¡®ä¿åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ</span><br>        <span class="hljs-keyword">if</span> (Looper.myLooper() == Looper.getMainLooper()) &#123;<br>            callback.onSuccess(processVideoSync(data));<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(Looper.getMainLooper()).post(() -&gt; &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    callback.onSuccess(processVideoSync(data));<br>                &#125; <span class="hljs-keyword"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeVideoProcessor</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processVideoOnMainThread</span><span class="hljs-params">(VideoData data, ProcessCallback callback)</span> &#123;<br>        <span class="hljs-comment">// ç¡®ä¿åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ</span><br>        <span class="hljs-keyword">if</span> (Looper.myLooper() == Looper.getMainLooper()) &#123;<br>            callback.onSuccess(processVideoSync(data));<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(Looper.getMainLooper()).post(() -&gt; &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    callback.onSuccess(processVideoSync(data));<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    callback.onError(e);<br>                &#125;<br>            &#125;);<br>        &#125;<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="3-ç¼–ç å…¼å®¹æ€§"><a href="#3-ç¼–ç å…¼å®¹æ€§" class="headerlink" title="3. ç¼–ç å…¼å®¹æ€§"></a>3. ç¼–ç å…¼å®¹æ€§</h3><p><strong>é—®é¢˜</strong>ï¼šä¸åŒè®¾å¤‡ç¼–ç å™¨æ”¯æŒæ€§å·®å¼‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MediaCodecUtils</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCodecSupported</span><span class="hljs-params">(String mimeType)</span> &#123;<br>        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.LOLLIPOP) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <br>        <span class="hljs-type">MediaCodecList</span> <span class="hljs-variable">codecs</span> <span class="hljs-operator">=</span> MediaCodecList.getCodecList();<br>        <span class="hljs-keyword">for</span> (MediaCodec codec : codecs) &#123;<br>            <span class="hljs-keyword">if</span> (codec.getName().contains(mimeType)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> MediaCodec <span class="hljs-title function_">getCompatibleCodec</span><span class="hljs-params">(String mimeType, MediaFormat format)</span> &#123;<br>        <span class="hljs-comment">// è·å–å…¼å®¹çš„ç¼–ç å™¨</span><br>        <span class="hljs-type">MediaCodecList</span> <span class="hljs-variable">codecs</span> <span class="hljs-operator">=</span> MediaCodecList.getCodecList();<br>        <span class="hljs-keyword">for</span> (MediaCodec codec : codecs) &#123;<br>            <span class="hljs-keyword">if</span> (codec.isEncoder()) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    codec.configure(format, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>);<br>                    <span class="hljs-keyword">return</span> codec;<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    Log.w(TAG, <span class="hljs-string">&quot;Codec configuration failed&quot;</span>, e);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MediaCodecUtils</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCodecSupported</span><span class="hljs-params">(String mimeType)</span> &#123;<br>        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.LOLLIPOP) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <br>        <span class="hljs-type">MediaCodecList</span> <span class="hljs-variable">codecs</span> <span class="hljs-operator">=</span> MediaCodecList.getCodecList();<br>        <span class="hljs-keyword">for</span> (MediaCodec codec : codecs) &#123;<br>            <span class="hljs-keyword">if</span> (codec.getName().contains(mimeType)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> MediaCodec <span class="hljs-title function_">getCompatibleCodec</span><span class="hljs-params">(String mimeType, MediaFormat format)</span> &#123;<br>        <span class="hljs-comment">// è·å–å…¼å®¹çš„ç¼–ç å™¨</span><br>        <span class="hljs-type">MediaCodecList</span> <span class="hljs-variable">codecs</span> <span class="hljs-operator">=</span> MediaCodecList.getCodecList();<br>        <span class="hljs-keyword">for</span> (MediaCodec codec : codecs) &#123;<br>            <span class="hljs-keyword">if</span> (codec.isEncoder()) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    codec.configure(format, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>);<br>                    <span class="hljs-keyword">return</span> codec;<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    Log.w(TAG, <span class="hljs-string">&quot;Codec configuration failed&quot;</span>, e);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"No compatible codec found"</span>);<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="4-å­˜å‚¨ç©ºé—´ä¸è¶³"><a href="#4-å­˜å‚¨ç©ºé—´ä¸è¶³" class="headerlink" title="4. å­˜å‚¨ç©ºé—´ä¸è¶³"></a>4. å­˜å‚¨ç©ºé—´ä¸è¶³</h3><p><strong>é—®é¢˜</strong>ï¼šå¤§æ–‡ä»¶å¤„ç†æ—¶å ç”¨è¿‡å¤šå­˜å‚¨ç©ºé—´</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StorageManager</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">CACHE_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 100MB</span><br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cacheVideoFrame</span><span class="hljs-params">(VideoFrame frame)</span> &#123;<br>        <span class="hljs-keyword">if</span> (getCacheSize() &gt; CACHE_SIZE) &#123;<br>            clearOldestCache();<br>        &#125;<br>        saveToCache(frame);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">streamProcessVideo</span><span class="hljs-params">(String videoPath)</span> &#123;<br>        <span class="hljs-type">File</span> <span class="hljs-variable">tempFile</span> <span class="hljs-operator">=</span> getTempFile();<br>        <br>        <span class="hljs-comment">// åˆ†å—å¤„ç†ï¼Œé¿å…å†…å­˜æº¢å‡º</span><br>        processVideoInChunks(videoPath, tempFile);<br>        <br>        <span class="hljs-comment"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StorageManager</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">CACHE_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 100MB</span><br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cacheVideoFrame</span><span class="hljs-params">(VideoFrame frame)</span> &#123;<br>        <span class="hljs-keyword">if</span> (getCacheSize() &gt; CACHE_SIZE) &#123;<br>            clearOldestCache();<br>        &#125;<br>        saveToCache(frame);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">streamProcessVideo</span><span class="hljs-params">(String videoPath)</span> &#123;<br>        <span class="hljs-type">File</span> <span class="hljs-variable">tempFile</span> <span class="hljs-operator">=</span> getTempFile();<br>        <br>        <span class="hljs-comment">// åˆ†å—å¤„ç†ï¼Œé¿å…å†…å­˜æº¢å‡º</span><br>        processVideoInChunks(videoPath, tempFile);<br>        <br>        <span class="hljs-comment">// å¤„ç†å®Œæˆåæ¸…ç†ä¸´æ—¶æ–‡ä»¶</span><br>        tempFile.delete();<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="å¯è¿ç§»ç»éªŒ"><a href="#å¯è¿ç§»ç»éªŒ" class="headerlink" title="å¯è¿ç§»ç»éªŒ"></a>å¯è¿ç§»ç»éªŒ</h2><h3 id="1-æŠ€æœ¯æ ˆè¿ç§»"><a href="#1-æŠ€æœ¯æ ˆè¿ç§»" class="headerlink" title="1. æŠ€æœ¯æ ˆè¿ç§»"></a>1. æŠ€æœ¯æ ˆè¿ç§»</h3><p><strong>ä» MediaPlayer åˆ° ExoPlayer</strong></p><ul><li><strong>ä¼˜åŠ¿</strong>ï¼šæ›´å¥½çš„æ€§èƒ½ã€æ›´å°çš„ä½“ç§¯ã€ç¡¬ä»¶è§£ç æ”¯æŒ</li><li><strong>è¿ç§»é‡ç‚¹</strong>ï¼šæ’­æ”¾å™¨é€»è¾‘ã€æ•°æ®æºæŠ½è±¡</li><li><strong>å…¼å®¹æ€§</strong>ï¼šä¿æŒæ—§ç‰ˆæœ¬æ”¯æŒçš„åŒæ—¶å¼•å…¥æ–°ç‰¹æ€§</li></ul><h3 id="2-ä»-FFmpeg-åˆ°-MediaCodec-OpenGL"><a href="#2-ä»-FFmpeg-åˆ°-MediaCodec-OpenGL" class="headerlink" title="2. ä» FFmpeg åˆ° MediaCodec + OpenGL"></a>2. ä» FFmpeg åˆ° MediaCodec + OpenGL</h3><ul><li><strong>ä¼˜åŠ¿</strong>ï¼šæ›´å¥½çš„ç”µæ± ç»­èˆªã€ç¡¬ä»¶åŠ é€Ÿã€ç³»ç»Ÿé›†æˆåº¦</li><li><strong>è¿ç§»é‡ç‚¹</strong>ï¼šç¼–ç é€»è¾‘ã€æ¸²æŸ“å¼•æ“</li><li><strong>æ··åˆç­–ç•¥</strong>ï¼šå¤æ‚ä½¿ç”¨ FFmpegï¼Œç®€å•ä½¿ç”¨ MediaCodec</li></ul><h3 id="3-ä»åŒæ­¥åˆ°å¼‚æ­¥å¤„ç†"><a href="#3-ä»åŒæ­¥åˆ°å¼‚æ­¥å¤„ç†" class="headerlink" title="3. ä»åŒæ­¥åˆ°å¼‚æ­¥å¤„ç†"></a>3. ä»åŒæ­¥åˆ°å¼‚æ­¥å¤„ç†</h3><ul><li><strong>ä¼˜åŠ¿</strong>ï¼šæ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€é¿å… ANR</li><li><strong>è¿ç§»é‡ç‚¹</strong>ï¼šæ•°æ®æµã€çŠ¶æ€ç®¡ç†ã€é”™è¯¯å¤„ç†</li><li><strong>è®¾è®¡æ¨¡å¼</strong>ï¼šè§‚å¯Ÿè€…æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼</li></ul><h3 id="4-ä»å•çº¿ç¨‹åˆ°å¤šçº¿ç¨‹"><a href="#4-ä»å•çº¿ç¨‹åˆ°å¤šçº¿ç¨‹" class="headerlink" title="4. ä»å•çº¿ç¨‹åˆ°å¤šçº¿ç¨‹"></a>4. ä»å•çº¿ç¨‹åˆ°å¤šçº¿ç¨‹</h3><ul><li><strong>ä¼˜åŠ¿</strong>ï¼šå……åˆ†åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨</li><li><strong>æŒ‘æˆ˜</strong>ï¼šçº¿ç¨‹å®‰å…¨ã€å¹¶å‘æ§åˆ¶</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šçº¿ç¨‹æ± ã€åŒæ­¥æœºåˆ¶ã€ä¸å¯å˜å¯¹è±¡</li></ul><h2 id="æœªæ¥å±•æœ›"><a href="#æœªæ¥å±•æœ›" class="headerlink" title="æœªæ¥å±•æœ›"></a>æœªæ¥å±•æœ›</h2><h3 id="1-AI-é©±åŠ¨å‰ªè¾‘"><a href="#1-AI-é©±åŠ¨å‰ªè¾‘" class="headerlink" title="1. AI é©±åŠ¨å‰ªè¾‘"></a>1. AI é©±åŠ¨å‰ªè¾‘</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AIVideoProcessor</span> &#123;<br>    <span class="hljs-keyword">private</span> TensorFlowLite model;<br>    <br>    <span class="hljs-keyword">public</span> VideoFrame <span class="hljs-title function_">enhanceVideo</span><span class="hljs-params">(VideoFrame frame)</span> &#123;<br>        <span class="hljs-comment">// æ™ºèƒ½å¢å¼ºï¼šè¶…åˆ†è¾¨ç‡ã€é™å™ªã€ç¨³å®šåŒ–</span><br>        <span class="hljs-keyword">return</span> aiEnhanceFrame(frame);<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> VideoFrame <span class="hljs-title function_">aiEnhanceFrame</span><span class="hljs-params">(VideoFrame frame)</span> &#123;<br>        <span class="hljs-comment">// TensorFlow Lite æ¨ç†</span><br>        <span class="hljs-type">TensorBuffer</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> preprocessFrame(frame);<br>        <span class="hljs-type">TensorBuffer</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> model.run(input);<br>        <span class="hljs-keyword"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AIVideoProcessor</span> &#123;<br>    <span class="hljs-keyword">private</span> TensorFlowLite model;<br>    <br>    <span class="hljs-keyword">public</span> VideoFrame <span class="hljs-title function_">enhanceVideo</span><span class="hljs-params">(VideoFrame frame)</span> &#123;<br>        <span class="hljs-comment">// æ™ºèƒ½å¢å¼ºï¼šè¶…åˆ†è¾¨ç‡ã€é™å™ªã€ç¨³å®šåŒ–</span><br>        <span class="hljs-keyword">return</span> aiEnhanceFrame(frame);<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> VideoFrame <span class="hljs-title function_">aiEnhanceFrame</span><span class="hljs-params">(VideoFrame frame)</span> &#123;<br>        <span class="hljs-comment">// TensorFlow Lite æ¨ç†</span><br>        <span class="hljs-type">TensorBuffer</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> preprocessFrame(frame);<br>        <span class="hljs-type">TensorBuffer</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> model.run(input);<br>        <span class="hljs-keyword">return</span> postprocessFrame(frame, output);<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="2-å®æ—¶åä½œç¼–è¾‘"><a href="#2-å®æ—¶åä½œç¼–è¾‘" class="headerlink" title="2. å®æ—¶åä½œç¼–è¾‘"></a>2. å®æ—¶åä½œç¼–è¾‘</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RealtimeVideoEditor</span> &#123;<br>    <span class="hljs-keyword">private</span> WebSocketServer webSocketServer;<br>    <span class="hljs-keyword">private</span> SessionManager sessionManager;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startCollaborativeEdit</span><span class="hljs-params">(String roomId)</span> &#123;<br>        sessionManager.createSession(roomId);<br>        webSocketServer.start();<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleRemoteEdit</span><span class="hljs-params">(EditOperation operation)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (operation.getType()) &#123;<br>            <span class="hljs-keyword">case</span> ADD_TRACK:<br>                addTrack(operation.getTrack());<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> APPLY_FILTER:<br>                applyFilter(operation.getFilter());<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> SPLIT_TRACK:<br>                splitTrack(operation.getTrack(), operation.getTimeUs());<br>                <span class="hljs-keyword"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RealtimeVideoEditor</span> &#123;<br>    <span class="hljs-keyword">private</span> WebSocketServer webSocketServer;<br>    <span class="hljs-keyword">private</span> SessionManager sessionManager;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startCollaborativeEdit</span><span class="hljs-params">(String roomId)</span> &#123;<br>        sessionManager.createSession(roomId);<br>        webSocketServer.start();<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleRemoteEdit</span><span class="hljs-params">(EditOperation operation)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (operation.getType()) &#123;<br>            <span class="hljs-keyword">case</span> ADD_TRACK:<br>                addTrack(operation.getTrack());<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> APPLY_FILTER:<br>                applyFilter(operation.getFilter());<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> SPLIT_TRACK:<br>                splitTrack(operation.getTrack(), operation.getTimeUs());<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>        broadcastOperation(operation);<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è§†é¢‘å‰ªè¾‘åº”ç”¨å¼€å‘æ˜¯ä¸€ä¸ªå¤æ‚çš„ç³»ç»Ÿå·¥ç¨‹ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘ï¼š</p><ul><li><strong>æ¶æ„è®¾è®¡</strong>ï¼šæ¨¡å—åŒ–ã€å¯æ‰©å±•ã€æ˜“ç»´æŠ¤</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå¼‚æ­¥å¤„ç†ã€å†…å­˜ç®¡ç†ã€ç¡¬ä»¶åŠ é€Ÿ</li><li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šå“åº”å¼è®¾è®¡ã€æµç•…äº¤äº’ã€é”™è¯¯å¤„ç†</li><li><strong>å›¢é˜Ÿåä½œ</strong>ï¼šæ ‡å‡†åŒ–æµç¨‹ã€ç‰ˆæœ¬æ§åˆ¶ã€æŒç»­é›†æˆ</li></ul><p>é€šè¿‡æœ¬æ–‡ä»‹ç»çš„è®¾è®¡æ¨¡å¼å’Œå®ç°æ–¹æ¡ˆï¼Œå¼€å‘è€…å¯ä»¥æ„å»ºå‡ºé«˜æ€§èƒ½ã€é«˜è´¨é‡çš„ç§»åŠ¨ç«¯è§†é¢‘å‰ªè¾‘åº”ç”¨ã€‚è®°ä½ï¼š<strong>å¥½çš„æ¶æ„æ˜¯æˆåŠŸçš„åŸºçŸ³ï¼ŒæŒç»­ä¼˜åŒ–æ˜¯å“è¶Šçš„å…³é”®</strong>ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>è§†é¢‘å‰ªè¾‘</category>
      
      <category>Multimedia</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è§†é¢‘å‰ªè¾‘</tag>
      
      <tag>Android</tag>
      
      <tag>OpenGL ES</tag>
      
      <tag>FFmpeg</tag>
      
      <tag>å¤šåª’ä½“å¤„ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼ - è½¯ä»¶æ¶æ„çš„æ ¸å¿ƒåŸåˆ™ä¸å®è·µ</title>
    <link href="/2025/12/18/architecture/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html"/>
    <url>/2025/12/18/architecture/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html</url>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯-é—®é¢˜"><a href="#èƒŒæ™¯-é—®é¢˜" class="headerlink" title="èƒŒæ™¯ &amp; é—®é¢˜"></a>èƒŒæ™¯ &amp; é—®é¢˜</h2><p>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é¢ä¸´è¿™æ ·çš„æŒ‘æˆ˜ï¼š</p><ul><li><strong>ä»£ç å¤ç”¨æ€§å·®</strong>ï¼šç›¸ä¼¼åŠŸèƒ½é‡å¤å®ç°</li><li><strong>å¯ç»´æŠ¤æ€§ä½</strong>ï¼šä¿®æ”¹ä¸€ä¸ªåŠŸèƒ½å½±å“å…¶ä»–æ¨¡å—</li><li><strong>å¯æ‰©å±•æ€§ä¸è¶³</strong>ï¼šæ–°åŠŸèƒ½éš¾ä»¥é›†æˆ</li><li><strong>å¯æµ‹è¯•æ€§å·®</strong>ï¼šå¤æ‚é€»è¾‘éš¾ä»¥å•å…ƒæµ‹è¯•</li></ul><p>è®¾è®¡æ¨¡å¼æ­£æ˜¯ä¸ºäº†è§£å†³è¿™äº›é€šç”¨é—®é¢˜çš„ç»è¿‡éªŒè¯çš„è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="ç»“è®ºå…ˆè¡Œï¼ˆTL-DRï¼‰"><a href="#ç»“è®ºå…ˆè¡Œï¼ˆTL-DRï¼‰" class="headerlink" title="ç»“è®ºå…ˆè¡Œï¼ˆTL;DRï¼‰"></a>ç»“è®ºå…ˆè¡Œï¼ˆTL;DRï¼‰</h2><p>è®¾è®¡æ¨¡å¼ä¸æ˜¯å…·ä½“çš„ä»£ç å®ç°ï¼Œè€Œæ˜¯è§£å†³é—®é¢˜çš„<strong>æ€æƒ³æ¨¡æ¿</strong>ã€‚æŒæ¡è®¾è®¡æ¨¡å¼èƒ½è®©ä½ ï¼š</p><ul><li>ğŸ¯ <strong>å¿«é€Ÿè¯†åˆ«é—®é¢˜ç±»å‹</strong>å¹¶åº”ç”¨æˆç†Ÿæ–¹æ¡ˆ</li><li>ğŸ› ï¸ <strong>ç¼–å†™å¯ç»´æŠ¤ä»£ç </strong>ï¼Œé™ä½ç³»ç»Ÿå¤æ‚åº¦</li><li>ğŸ“š <strong>æå‡ç³»ç»Ÿå¯æ‰©å±•æ€§</strong>ï¼Œè½»æ¾æ·»åŠ æ–°åŠŸèƒ½</li><li>ğŸ§ª <strong>æ”¹å–„å›¢é˜Ÿåä½œ</strong>ï¼Œç»Ÿä¸€æŠ€æœ¯è¯­è¨€å’Œè®¾è®¡æ€è·¯</li></ul><h2 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h2><h3 id="è®¾è®¡æ¨¡å¼çš„æœ¬è´¨"><a href="#è®¾è®¡æ¨¡å¼çš„æœ¬è´¨" class="headerlink" title="è®¾è®¡æ¨¡å¼çš„æœ¬è´¨"></a>è®¾è®¡æ¨¡å¼çš„æœ¬è´¨</h3><p>è®¾è®¡æ¨¡å¼æ˜¯<strong>åœ¨ç‰¹å®šä¸Šä¸‹æ–‡ä¸­è§£å†³è½¯ä»¶è®¾è®¡é—®é¢˜çš„æ–¹æ¡ˆ</strong>ï¼Œå®ƒåŒ…å«ï¼š</p><ol><li><strong>é—®é¢˜ä¸Šä¸‹æ–‡</strong> - ä½•æ—¶ä½¿ç”¨è¯¥æ¨¡å¼</li><li><strong>è§£å†³æ–¹æ¡ˆç»“æ„</strong> - ç±»å’Œå¯¹è±¡çš„å…³ç³»</li><li><strong>åä½œå…³ç³»</strong> - å¯¹è±¡å¦‚ä½•äº¤äº’</li><li><strong>å®ç°æ•ˆæœ</strong> - ä½¿ç”¨è¯¥æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</li></ol><h3 id="GoF-è®¾è®¡æ¨¡å¼åˆ†ç±»"><a href="#GoF-è®¾è®¡æ¨¡å¼åˆ†ç±»" class="headerlink" title="GoF è®¾è®¡æ¨¡å¼åˆ†ç±»"></a>GoF è®¾è®¡æ¨¡å¼åˆ†ç±»</h3><h4 id="1-åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreationalï¼‰"><a href="#1-åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreationalï¼‰" class="headerlink" title="1. åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreationalï¼‰"></a>1. åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreationalï¼‰</h4><p><strong>ç›®çš„</strong>ï¼šæ§åˆ¶å¯¹è±¡åˆ›å»ºè¿‡ç¨‹ï¼Œéšè—åˆ›å»ºé€»è¾‘</p><table><thead><tr><th>æ¨¡å¼</th><th>è§£å†³é—®é¢˜</th><th>åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>å·¥å‚æ–¹æ³•</strong></td><td>å¯¹è±¡åˆ›å»ºçš„ç»Ÿä¸€æ¥å£</td><td>æ ¹æ®å‚æ•°åˆ›å»ºä¸åŒäº§å“å¯¹è±¡</td></tr><tr><td><strong>æŠ½è±¡å·¥å‚</strong></td><td>åˆ›å»ºå¯¹è±¡æ—çš„ç»Ÿä¸€æ¥å£</td><td>æ”¯æŒäº§å“æ—çš„æ‰©å±•</td></tr><tr><td><strong>å•ä¾‹æ¨¡å¼</strong></td><td>ç¡®ä¿ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹</td><td>å…¨å±€é…ç½®ç®¡ç†å™¨ã€æ—¥å¿—å¯¹è±¡</td></tr><tr><td><strong>å»ºé€ è€…æ¨¡å¼</strong></td><td>å¤æ‚å¯¹è±¡æ„å»ºçš„åˆ†æ­¥éª¤</td><td>å‚æ•°åŒ–æ„å»ºã€éªŒè¯åˆ›å»º</td></tr></tbody></table><h4 id="2-ç»“æ„å‹æ¨¡å¼ï¼ˆStructuralï¼‰"><a href="#2-ç»“æ„å‹æ¨¡å¼ï¼ˆStructuralï¼‰" class="headerlink" title="2. ç»“æ„å‹æ¨¡å¼ï¼ˆStructuralï¼‰"></a>2. ç»“æ„å‹æ¨¡å¼ï¼ˆStructuralï¼‰</h4><p><strong>ç›®çš„</strong>ï¼šå¦‚ä½•ç»„ç»‡ç±»å’Œå¯¹è±¡å½¢æˆæ›´å¤§çš„ç»“æ„</p><table><thead><tr><th>æ¨¡å¼</th><th>è§£å†³é—®é¢˜</th><th>åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>é€‚é…å™¨æ¨¡å¼</strong></td><td>æ¥å£ä¸å…¼å®¹çš„ç±»ä¹‹é—´çš„é€‚é…</td><td>æ–°æ—§ç³»ç»Ÿæ¥å£ç»Ÿä¸€</td></tr><tr><td><strong>æ¡¥æ¥æ¨¡å¼</strong></td><td>å°†æ¥å£åˆ’åˆ†ä¸ºå¤šä¸ªå­æ¥å£</td><td>é¿å…æ¥å£æ±¡æŸ“</td></tr><tr><td><strong>ç»„åˆæ¨¡å¼</strong></td><td>å¯¹è±¡ç»„åˆæ ‘å½¢ç»“æ„</td><td>ç»Ÿä¸€å¤„ç†å¶å­èŠ‚ç‚¹å¯¹è±¡</td></tr><tr><td><strong>è£…é¥°å™¨æ¨¡å¼</strong></td><td>åŠ¨æ€æ·»åŠ å¯¹è±¡èŒè´£</td><td>åŠŸèƒ½æ’ä»¶åŒ–ã€AOPåˆ‡é¢</td></tr></tbody></table><h4 id="3-è¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioralï¼‰"><a href="#3-è¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioralï¼‰" class="headerlink" title="3. è¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioralï¼‰"></a>3. è¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioralï¼‰</h4><p><strong>ç›®çš„</strong>ï¼šå¯¹è±¡é—´èŒè´£åˆ†é…å’Œé€šä¿¡</p><table><thead><tr><th>æ¨¡å¼</th><th>è§£å†³é—®é¢˜</th><th>åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>è§‚å¯Ÿè€…æ¨¡å¼</strong></td><td>å¯¹è±¡é—´æ¾è€¦åˆé€šä¿¡</td><td>äº‹ä»¶ç›‘å¬ã€æ¶ˆæ¯é˜Ÿåˆ—</td></tr><tr><td><strong>å‘½ä»¤æ¨¡å¼</strong></td><td>å°†è¯·æ±‚å°è£…ä¸ºå¯¹è±¡</td><td>å®å‘½ä»¤ã€æ’¤é”€æ“ä½œ</td></tr><tr><td><strong>çŠ¶æ€æ¨¡å¼</strong></td><td>å¯¹è±¡çŠ¶æ€å˜åŒ–çš„è¡Œä¸ºæ§åˆ¶</td><td>å·¥ä½œæµå¼•æ“ã€æ¸¸æˆè§’è‰²</td></tr><tr><td><strong>ç­–ç•¥æ¨¡å¼</strong></td><td>ç®—æ³•æ—çš„å°è£…å’Œåˆ‡æ¢</td><td>æ”¯ä»˜æ–¹å¼ã€æ’åºç®—æ³•</td></tr></tbody></table><h4 id="4-å…¶ä»–æ¨¡å¼"><a href="#4-å…¶ä»–æ¨¡å¼" class="headerlink" title="4. å…¶ä»–æ¨¡å¼"></a>4. å…¶ä»–æ¨¡å¼</h4><table><thead><tr><th>æ¨¡å¼</th><th>è§£å†³é—®é¢˜</th><th>åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>æ¨¡æ¿æ–¹æ³•</strong></td><td>æ“ä½œæ­¥éª¤æ¨¡æ¿</td><td>æ•°æ®å¤„ç†æµç¨‹</td></tr><tr><td><strong>è¿­ä»£å™¨æ¨¡å¼</strong></td><td>ç»Ÿä¸€è®¿é—®é›†åˆå¯¹è±¡</td><td>å®¹å™¨éå†ã€æ•°æ®æµå¤„ç†</td></tr><tr><td><strong>ä»£ç†æ¨¡å¼</strong></td><td>å¯¹è±¡è®¿é—®çš„é—´æ¥æ§åˆ¶</td><td>å»¶è¿ŸåŠ è½½ã€è®¿é—®æ§åˆ¶</td></tr><tr><td><strong>äº«å…ƒæ¨¡å¼</strong></td><td>ç»†ç²’åº¦å¯¹è±¡å¤ç”¨</td><td>å¯¹è±¡æ± ã€å†…å­˜ä¼˜åŒ–</td></tr></tbody></table><h2 id="å®ç°æ–¹æ¡ˆ"><a href="#å®ç°æ–¹æ¡ˆ" class="headerlink" title="å®ç°æ–¹æ¡ˆ"></a>å®ç°æ–¹æ¡ˆ</h2><h3 id="1-å·¥å‚æ¨¡å¼å®æˆ˜"><a href="#1-å·¥å‚æ¨¡å¼å®æˆ˜" class="headerlink" title="1. å·¥å‚æ¨¡å¼å®æˆ˜"></a>1. å·¥å‚æ¨¡å¼å®æˆ˜</h3><h4 id="é—®é¢˜åœºæ™¯"><a href="#é—®é¢˜åœºæ™¯" class="headerlink" title="é—®é¢˜åœºæ™¯"></a>é—®é¢˜åœºæ™¯</h4><p>éœ€è¦æ”¯æŒå¤šç§æ•°æ®åº“è¿æ¥ï¼ˆMySQLã€PostgreSQLã€MongoDBï¼‰ï¼Œæ¯ç§æ•°æ®åº“æœ‰ä¸åŒçš„è¿æ¥å‚æ•°å’Œåˆå§‹åŒ–æ–¹å¼ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-comment">// æŠ½è±¡å·¥å‚æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DatabaseConnectionFactory</span> &#123;<br>    Connection <span class="hljs-title function_">createConnection</span><span class="hljs-params">(String config)</span>;<br>    String <span class="hljs-title function_">getDatabaseType</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsTransaction</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-comment">// å…·ä½“å·¥å‚å®ç°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySQLConnectionFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DatabaseConnectionFactory</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Connection <span class="hljs-title function_">createConnection</span><span class="hljs-params">(String config)</span> &#123;<br>        <span class="hljs-comment">// MySQL è¿æ¥åˆ›å»ºé€»è¾‘</span><br>        <span class="hljs-keyword">return</span> DriverManager.getConnection(config);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDatabaseType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;MySQL&quot;</span>;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsTransaction</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å·¥å‚ç®¡ç†å™¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseFactory</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, DatabaseConnectionFactory&gt; factories = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    <br>    <span class="hljs-keyword">static</span> &#123;<br>        factories.put(<span class="hljs-string">&quot;mysql&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MySQLConnectionFactory</span>());<br>        factories.put(<span class="hljs-string">&quot;postgresql&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">PostgreSQLConnectionFactory</span>());<br>        factories.put(<span class="hljs-string">&quot;mongodb&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoDBConnectionFactory</span>());<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title function_">createConnection</span><span class="hljs-params">(String type, String config)</span> &#123;<br>        <span class="hljs-type">DatabaseConnectionFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> factories.get(type.toLowerCase());<br>        <span class="hljs-keyword">if</span> (factory != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> factory.createConnection(config);<br>        &#125;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Unsupported database type: &quot;</span> + type);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å®¢æˆ·ç«¯ä½¿ç”¨</span><br><span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> DatabaseFactory.createConnection(<span class="hljs-string">&quot;mysql&quot;</span>, <span class="hljs-string"><code class="language-hljs java"><span class="hljs-comment">// æŠ½è±¡å·¥å‚æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DatabaseConnectionFactory</span> &#123;<br>    Connection <span class="hljs-title function_">createConnection</span><span class="hljs-params">(String config)</span>;<br>    String <span class="hljs-title function_">getDatabaseType</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsTransaction</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-comment">// å…·ä½“å·¥å‚å®ç°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySQLConnectionFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DatabaseConnectionFactory</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Connection <span class="hljs-title function_">createConnection</span><span class="hljs-params">(String config)</span> &#123;<br>        <span class="hljs-comment">// MySQL è¿æ¥åˆ›å»ºé€»è¾‘</span><br>        <span class="hljs-keyword">return</span> DriverManager.getConnection(config);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDatabaseType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;MySQL&quot;</span>;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsTransaction</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å·¥å‚ç®¡ç†å™¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseFactory</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, DatabaseConnectionFactory&gt; factories = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    <br>    <span class="hljs-keyword">static</span> &#123;<br>        factories.put(<span class="hljs-string">&quot;mysql&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MySQLConnectionFactory</span>());<br>        factories.put(<span class="hljs-string">&quot;postgresql&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">PostgreSQLConnectionFactory</span>());<br>        factories.put(<span class="hljs-string">&quot;mongodb&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoDBConnectionFactory</span>());<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title function_">createConnection</span><span class="hljs-params">(String type, String config)</span> &#123;<br>        <span class="hljs-type">DatabaseConnectionFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> factories.get(type.toLowerCase());<br>        <span class="hljs-keyword">if</span> (factory != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> factory.createConnection(config);<br>        &#125;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Unsupported database type: &quot;</span> + type);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å®¢æˆ·ç«¯ä½¿ç”¨</span><br><span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> DatabaseFactory.createConnection(<span class="hljs-string">&quot;mysql&quot;</span>, <span class="hljs-string">"jdbc:mysql://localhost:3306/mydb"</span>);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="2-å•ä¾‹æ¨¡å¼å®æˆ˜"><a href="#2-å•ä¾‹æ¨¡å¼å®æˆ˜" class="headerlink" title="2. å•ä¾‹æ¨¡å¼å®æˆ˜"></a>2. å•ä¾‹æ¨¡å¼å®æˆ˜</h3><h4 id="é—®é¢˜åœºæ™¯-1"><a href="#é—®é¢˜åœºæ™¯-1" class="headerlink" title="é—®é¢˜åœºæ™¯"></a>é—®é¢˜åœºæ™¯</h4><p>å…¨å±€é…ç½®ç®¡ç†å™¨éœ€è¦åœ¨æ•´ä¸ªåº”ç”¨ä¸­ä¿æŒå”¯ä¸€å®ä¾‹ï¼Œé¿å…é…ç½®ä¸ä¸€è‡´ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-comment">// æ‡’æ±‰å¼å•ä¾‹ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurationManager</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> ConfigurationManager instance;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>    <br>    <span class="hljs-keyword">private</span> Properties properties;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">ConfigurationManager</span><span class="hljs-params">()</span> &#123;<br>        loadConfiguration();<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ConfigurationManager <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">synchronized</span> (lock) &#123;<br>                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>                    instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigurationManager</span>();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadConfiguration</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// ä»é…ç½®æ–‡ä»¶åŠ è½½é…ç½®</span><br>        properties = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();<br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">InputStream</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> getClass().getResourceAsStream(<span class="hljs-string">&quot;/config.properties&quot;</span>)) &#123;<br>            properties.load(input);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Failed to load configuration&quot;</span>, e);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getProperty</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-keyword">return</span> properties.getProperty(key);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getProperty</span><span class="hljs-params">(String key, String defaultValue)</span> &#123;<br>        <span class="hljs-keyword"><code class="language-hljs java"><span class="hljs-comment">// æ‡’æ±‰å¼å•ä¾‹ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurationManager</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> ConfigurationManager instance;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>    <br>    <span class="hljs-keyword">private</span> Properties properties;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">ConfigurationManager</span><span class="hljs-params">()</span> &#123;<br>        loadConfiguration();<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ConfigurationManager <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">synchronized</span> (lock) &#123;<br>                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>                    instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigurationManager</span>();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadConfiguration</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// ä»é…ç½®æ–‡ä»¶åŠ è½½é…ç½®</span><br>        properties = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();<br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">InputStream</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> getClass().getResourceAsStream(<span class="hljs-string">&quot;/config.properties&quot;</span>)) &#123;<br>            properties.load(input);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Failed to load configuration&quot;</span>, e);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getProperty</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-keyword">return</span> properties.getProperty(key);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getProperty</span><span class="hljs-params">(String key, String defaultValue)</span> &#123;<br>        <span class="hljs-keyword">return</span> properties.getProperty(key, defaultValue);<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="3-è§‚å¯Ÿè€…æ¨¡å¼å®æˆ˜"><a href="#3-è§‚å¯Ÿè€…æ¨¡å¼å®æˆ˜" class="headerlink" title="3. è§‚å¯Ÿè€…æ¨¡å¼å®æˆ˜"></a>3. è§‚å¯Ÿè€…æ¨¡å¼å®æˆ˜</h3><h4 id="é—®é¢˜åœºæ™¯-2"><a href="#é—®é¢˜åœºæ™¯-2" class="headerlink" title="é—®é¢˜åœºæ™¯"></a>é—®é¢˜åœºæ™¯</h4><p>ç”¨æˆ·æ³¨å†Œç³»ç»Ÿéœ€è¦åœ¨ç”¨æˆ·çŠ¶æ€å˜åŒ–æ—¶é€šçŸ¥æ‰€æœ‰ç›¸å…³çš„ç›‘å¬å™¨ï¼ˆé‚®ä»¶é€šçŸ¥ã€æ—¥å¿—è®°å½•ç­‰ï¼‰ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-2"><a href="#è§£å†³æ–¹æ¡ˆ-2" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-comment">// è§‚å¯Ÿè€…æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserObserver</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onUserRegistered</span><span class="hljs-params">(User user)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onUserStatusChanged</span><span class="hljs-params">(User user, String oldStatus, String newStatus)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onUserDeleted</span><span class="hljs-params">(User user)</span>;<br>&#125;<br><br><span class="hljs-comment">// ä¸»é¢˜æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserSubject</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerObserver</span><span class="hljs-params">(UserObserver observer)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeObserver</span><span class="hljs-params">(UserObserver observer)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyObservers</span><span class="hljs-params">(UserEventType eventType, User user)</span>;<br>&#125;<br><br><span class="hljs-comment">// å…·ä½“ä¸»é¢˜å®ç°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserSubject</span> &#123;<br>    <span class="hljs-keyword">private</span> List&lt;UserObserver&gt; observers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> List&lt;User&gt; users = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerObserver</span><span class="hljs-params">(UserObserver observer)</span> &#123;<br>        <span class="hljs-keyword">if</span> (!observers.contains(observer)) &#123;<br>            observers.add(observer);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeObserver</span><span class="hljs-params">(UserObserver observer)</span> &#123;<br>        observers.remove(observer);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyObservers</span><span class="hljs-params">(UserEventType eventType, User user)</span> &#123;<br>        <span class="hljs-keyword">for</span> (UserObserver observer : observers) &#123;<br>            <span class="hljs-keyword">switch</span> (eventType) &#123;<br>                <span class="hljs-keyword">case</span> USER_REGISTERED:<br>                    observer.onUserRegistered(user);<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">case</span> STATUS_CHANGED:<br>                    observer.onUserStatusChanged(user, user.getOldStatus(), user.getStatus());<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">case</span> USER_DELETED:<br>                    observer.onUserDeleted(user);<br>                    <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">changeUserStatus</span><span class="hljs-params">(User user, String newStatus)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">oldStatus</span> <span class="hljs-operator">=</span> user.getStatus();<br>        user.setStatus(newStatus);<br>        notifyObservers(UserEventType.STATUS_CHANGED, user);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å…·ä½“è§‚å¯Ÿè€…å®ç°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmailNotificationService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserObserver</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onUserRegistered</span><span class="hljs-params">(User user)</span> &#123;<br>        sendWelcomeEmail(user.getEmail());<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onUserStatusChanged</span><span class="hljs-params">(User user, String oldStatus, String newStatus)</span> &#123;<br>        sendStatusChangeEmail(user.getEmail(), oldStatus, newStatus);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onUserDeleted</span><span class="hljs-params">(User user)</span> &#123;<br>        sendDeletionEmail(user.getEmail());<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendWelcomeEmail</span><span class="hljs-params">(String email)</span> &#123; <span class="hljs-comment">/* å®ç° */</span> &#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendStatusChangeEmail</span><span class="hljs-params">(String email, String oldStatus, String newStatus)</span> &#123; <span class="hljs-comment">/* å®ç° */</span> &#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendDeletionEmail</span><span class="hljs-params">(String email)</span> &#123; <span class="hljs-comment"><code class="language-hljs java"><span class="hljs-comment">// è§‚å¯Ÿè€…æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserObserver</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onUserRegistered</span><span class="hljs-params">(User user)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onUserStatusChanged</span><span class="hljs-params">(User user, String oldStatus, String newStatus)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onUserDeleted</span><span class="hljs-params">(User user)</span>;<br>&#125;<br><br><span class="hljs-comment">// ä¸»é¢˜æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserSubject</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerObserver</span><span class="hljs-params">(UserObserver observer)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeObserver</span><span class="hljs-params">(UserObserver observer)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyObservers</span><span class="hljs-params">(UserEventType eventType, User user)</span>;<br>&#125;<br><br><span class="hljs-comment">// å…·ä½“ä¸»é¢˜å®ç°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserSubject</span> &#123;<br>    <span class="hljs-keyword">private</span> List&lt;UserObserver&gt; observers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> List&lt;User&gt; users = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerObserver</span><span class="hljs-params">(UserObserver observer)</span> &#123;<br>        <span class="hljs-keyword">if</span> (!observers.contains(observer)) &#123;<br>            observers.add(observer);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeObserver</span><span class="hljs-params">(UserObserver observer)</span> &#123;<br>        observers.remove(observer);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyObservers</span><span class="hljs-params">(UserEventType eventType, User user)</span> &#123;<br>        <span class="hljs-keyword">for</span> (UserObserver observer : observers) &#123;<br>            <span class="hljs-keyword">switch</span> (eventType) &#123;<br>                <span class="hljs-keyword">case</span> USER_REGISTERED:<br>                    observer.onUserRegistered(user);<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">case</span> STATUS_CHANGED:<br>                    observer.onUserStatusChanged(user, user.getOldStatus(), user.getStatus());<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">case</span> USER_DELETED:<br>                    observer.onUserDeleted(user);<br>                    <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">changeUserStatus</span><span class="hljs-params">(User user, String newStatus)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">oldStatus</span> <span class="hljs-operator">=</span> user.getStatus();<br>        user.setStatus(newStatus);<br>        notifyObservers(UserEventType.STATUS_CHANGED, user);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å…·ä½“è§‚å¯Ÿè€…å®ç°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmailNotificationService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserObserver</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onUserRegistered</span><span class="hljs-params">(User user)</span> &#123;<br>        sendWelcomeEmail(user.getEmail());<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onUserStatusChanged</span><span class="hljs-params">(User user, String oldStatus, String newStatus)</span> &#123;<br>        sendStatusChangeEmail(user.getEmail(), oldStatus, newStatus);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onUserDeleted</span><span class="hljs-params">(User user)</span> &#123;<br>        sendDeletionEmail(user.getEmail());<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendWelcomeEmail</span><span class="hljs-params">(String email)</span> &#123; <span class="hljs-comment">/* å®ç° */</span> &#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendStatusChangeEmail</span><span class="hljs-params">(String email, String oldStatus, String newStatus)</span> &#123; <span class="hljs-comment">/* å®ç° */</span> &#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendDeletionEmail</span><span class="hljs-params">(String email)</span> &#123; <span class="hljs-comment">/* å®ç° */</span> &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="æ ¸å¿ƒä»£ç "><a href="#æ ¸å¿ƒä»£ç " class="headerlink" title="æ ¸å¿ƒä»£ç "></a>æ ¸å¿ƒä»£ç </h2><h3 id="Android-å¼€å‘ä¸­çš„è®¾è®¡æ¨¡å¼åº”ç”¨"><a href="#Android-å¼€å‘ä¸­çš„è®¾è®¡æ¨¡å¼åº”ç”¨" class="headerlink" title="Android å¼€å‘ä¸­çš„è®¾è®¡æ¨¡å¼åº”ç”¨"></a>Android å¼€å‘ä¸­çš„è®¾è®¡æ¨¡å¼åº”ç”¨</h3><h4 id="1-Retrofit-ä¸­çš„é€‚é…å™¨æ¨¡å¼"><a href="#1-Retrofit-ä¸­çš„é€‚é…å™¨æ¨¡å¼" class="headerlink" title="1. Retrofit ä¸­çš„é€‚é…å™¨æ¨¡å¼"></a>1. Retrofit ä¸­çš„é€‚é…å™¨æ¨¡å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-comment">// ä¸åŒç½‘ç»œè¯·æ±‚çš„é€‚é…å™¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Call</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Cloneable</span> &#123;<br>    Response&lt;T&gt; <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SynchronousCallAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Call</span>&lt;Response&lt;String&gt;&gt; &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Call&lt;Response&lt;String&gt;&gt; delegateCall;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SynchronousCallAdapter</span><span class="hljs-params">(Call&lt;Response&lt;String&gt;&gt; delegateCall)</span> &#123;<br>        <span class="hljs-built_in">this</span>.delegateCall = delegateCall;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Response&lt;String&gt; <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Response&lt;String&gt; response = delegateCall.execute();<br>            <span class="hljs-comment">// åŒæ­¥æ‰§è¡Œå¹¶å¤„ç†ç»“æœ</span><br>            <span class="hljs-keyword">return</span> response;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> e;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Call&lt;Response&lt;String&gt;&gt; <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_"><code class="language-hljs java"><span class="hljs-comment">// ä¸åŒç½‘ç»œè¯·æ±‚çš„é€‚é…å™¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Call</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Cloneable</span> &#123;<br>    Response&lt;T&gt; <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SynchronousCallAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Call</span>&lt;Response&lt;String&gt;&gt; &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Call&lt;Response&lt;String&gt;&gt; delegateCall;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SynchronousCallAdapter</span><span class="hljs-params">(Call&lt;Response&lt;String&gt;&gt; delegateCall)</span> &#123;<br>        <span class="hljs-built_in">this</span>.delegateCall = delegateCall;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Response&lt;String&gt; <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Response&lt;String&gt; response = delegateCall.execute();<br>            <span class="hljs-comment">// åŒæ­¥æ‰§è¡Œå¹¶å¤„ç†ç»“æœ</span><br>            <span class="hljs-keyword">return</span> response;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> e;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Call&lt;Response&lt;String&gt;&gt; <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronousCallAdapter</span><>(delegateCall.clone());<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h4 id="2-EventBus-ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼"><a href="#2-EventBus-ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="2. EventBus ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼"></a>2. EventBus ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-comment">// EventBus ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EventBus</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;Class&lt;?&gt;, List&lt;Subscriber&gt;&gt; subscribers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(Object subscriber)</span> &#123;<br>        register(subscriber.getClass(), subscriber);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(Class&lt;?&gt; eventType, Object subscriber)</span> &#123;<br>        subscribers.computeIfAbsent(eventType, k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;&gt;()).add(subscriber);<br>    &#125;<br>    <br>    <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">post</span><span class="hljs-params">(Object event)</span> &#123;<br>        Class&lt;?&gt; eventType = event.getClass();<br>        List&lt;Subscriber&gt; eventSubscribers = subscribers.get(eventType);<br>        <span class="hljs-keyword">if</span> (eventSubscribers != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword"><code class="language-hljs java"><span class="hljs-comment">// EventBus ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EventBus</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;Class&lt;?&gt;, List&lt;Subscriber&gt;&gt; subscribers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(Object subscriber)</span> &#123;<br>        register(subscriber.getClass(), subscriber);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(Class&lt;?&gt; eventType, Object subscriber)</span> &#123;<br>        subscribers.computeIfAbsent(eventType, k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;&gt;()).add(subscriber);<br>    &#125;<br>    <br>    <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">post</span><span class="hljs-params">(Object event)</span> &#123;<br>        Class&lt;?&gt; eventType = event.getClass();<br>        List&lt;Subscriber&gt; eventSubscribers = subscribers.get(eventType);<br>        <span class="hljs-keyword">if</span> (eventSubscribers != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">for</span> (Subscriber subscriber : eventSubscribers) &#123;<br>                subscriber.handleEvent(event);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="å¸¸è§å‘"><a href="#å¸¸è§å‘" class="headerlink" title="å¸¸è§å‘"></a>å¸¸è§å‘</h2><h3 id="1-è¿‡åº¦ä½¿ç”¨è®¾è®¡æ¨¡å¼"><a href="#1-è¿‡åº¦ä½¿ç”¨è®¾è®¡æ¨¡å¼" class="headerlink" title="1. è¿‡åº¦ä½¿ç”¨è®¾è®¡æ¨¡å¼"></a>1. è¿‡åº¦ä½¿ç”¨è®¾è®¡æ¨¡å¼</h3><p><strong>å‘</strong>ï¼šä¸ºäº†ç”¨è€Œç”¨ï¼Œåˆ°å¤„å¥—ç”¨è®¾è®¡æ¨¡å¼<br><strong>åæœ</strong>ï¼šå¢åŠ ç³»ç»Ÿå¤æ‚åº¦ï¼Œé™ä½ä»£ç å¯è¯»æ€§<br><strong>è§£å†³</strong>ï¼šåªåœ¨çœŸæ­£éœ€è¦æ—¶ä½¿ç”¨ï¼Œä¼˜å…ˆç®€å•çš„ç›´æ¥è§£å†³æ–¹æ¡ˆ</p><h3 id="2-å¿½è§†è®¾è®¡åŸåˆ™"><a href="#2-å¿½è§†è®¾è®¡åŸåˆ™" class="headerlink" title="2. å¿½è§†è®¾è®¡åŸåˆ™"></a>2. å¿½è§†è®¾è®¡åŸåˆ™</h3><p><strong>å‘</strong>ï¼šé€‰æ‹©è®¾è®¡æ¨¡å¼æ—¶ä¸è€ƒè™‘ SOLID åŸåˆ™<br><strong>åæœ</strong>ï¼šä»£ç éš¾ä»¥ç»´æŠ¤å’Œæ‰©å±•<br><strong>è§£å†³</strong>ï¼šæ¯ä¸ªæ¨¡å¼é€‰æ‹©éƒ½è¦è¯„ä¼°å…¶ç¬¦åˆæ€§</p><h3 id="3-æ¨¡å¼å®ç°é”™è¯¯"><a href="#3-æ¨¡å¼å®ç°é”™è¯¯" class="headerlink" title="3. æ¨¡å¼å®ç°é”™è¯¯"></a>3. æ¨¡å¼å®ç°é”™è¯¯</h3><p><strong>å‘</strong>ï¼šè®¾è®¡æ¨¡å¼çš„é”™è¯¯å®ç°å¯¼è‡´åæ¨¡å¼<br><strong>åæœ</strong>ï¼šè¿èƒŒè®¾è®¡åˆè¡·ï¼Œå¢åŠ å¤æ‚åº¦<br><strong>è§£å†³</strong>ï¼šæ·±å…¥ç†è§£æ¨¡å¼æ„å›¾ï¼Œç¡®ä¿å®ç°æ­£ç¡®æ€§</p><h2 id="å¯è¿ç§»ç»éªŒ"><a href="#å¯è¿ç§»ç»éªŒ" class="headerlink" title="å¯è¿ç§»ç»éªŒ"></a>å¯è¿ç§»ç»éªŒ</h2><h3 id="1-ä»å·¥å‚æ¨¡å¼åˆ°ä¾èµ–æ³¨å…¥"><a href="#1-ä»å·¥å‚æ¨¡å¼åˆ°ä¾èµ–æ³¨å…¥" class="headerlink" title="1. ä»å·¥å‚æ¨¡å¼åˆ°ä¾èµ–æ³¨å…¥"></a>1. ä»å·¥å‚æ¨¡å¼åˆ°ä¾èµ–æ³¨å…¥</h3><p><strong>ç»éªŒ</strong>ï¼šåœ¨ç°ä»£æ¡†æ¶ä¸­ï¼Œä¾èµ–æ³¨å…¥å®¹å™¨ï¼ˆå¦‚ Daggerã€Springï¼‰èƒ½æ›´å¥½åœ°ç®¡ç†å¯¹è±¡åˆ›å»º<br><strong>è¿ç§»</strong>ï¼šä½¿ç”¨æ¡†æ¶çš„ä¾èµ–æ³¨å…¥æ›¿ä»£æ‰‹åŠ¨å·¥å‚å®ç°</p><h3 id="2-ä»è§‚å¯Ÿè€…æ¨¡å¼åˆ°å“åº”å¼ç¼–ç¨‹"><a href="#2-ä»è§‚å¯Ÿè€…æ¨¡å¼åˆ°å“åº”å¼ç¼–ç¨‹" class="headerlink" title="2. ä»è§‚å¯Ÿè€…æ¨¡å¼åˆ°å“åº”å¼ç¼–ç¨‹"></a>2. ä»è§‚å¯Ÿè€…æ¨¡å¼åˆ°å“åº”å¼ç¼–ç¨‹</h3><p><strong>ç»éªŒ</strong>ï¼šRxJavaã€Kotlin Flow ç­‰å“åº”å¼ç¼–ç¨‹èŒƒå¼æä¾›äº†æ›´å¼ºå¤§çš„äº‹ä»¶å¤„ç†èƒ½åŠ›<br><strong>è¿ç§»</strong>ï¼šå°†äº‹ä»¶é©±åŠ¨çš„é€»è¾‘è¿ç§»åˆ°å“åº”å¼æµå¤„ç†</p><h3 id="3-ä»å•ä¾‹æ¨¡å¼åˆ°å®¹å™¨ç®¡ç†"><a href="#3-ä»å•ä¾‹æ¨¡å¼åˆ°å®¹å™¨ç®¡ç†" class="headerlink" title="3. ä»å•ä¾‹æ¨¡å¼åˆ°å®¹å™¨ç®¡ç†"></a>3. ä»å•ä¾‹æ¨¡å¼åˆ°å®¹å™¨ç®¡ç†</h3><p><strong>ç»éªŒ</strong>ï¼šåº”ç”¨å®¹å™¨çš„å•ä¾‹ç®¡ç†æ›´åŠ å®‰å…¨å’Œçµæ´»<br><strong>è¿ç§»</strong>ï¼šä½¿ç”¨ @Singleton æ³¨è§£è®©å®¹å™¨ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ</p><h3 id="4-è®¾è®¡æ¨¡å¼çš„ç»„åˆä½¿ç”¨"><a href="#4-è®¾è®¡æ¨¡å¼çš„ç»„åˆä½¿ç”¨" class="headerlink" title="4. è®¾è®¡æ¨¡å¼çš„ç»„åˆä½¿ç”¨"></a>4. è®¾è®¡æ¨¡å¼çš„ç»„åˆä½¿ç”¨</h3><p><strong>ç»éªŒ</strong>ï¼šå¤æ‚åœºæ™¯é€šå¸¸éœ€è¦å¤šç§æ¨¡å¼ååŒå·¥ä½œ<br><strong>å®è·µ</strong>ï¼šå·¥å‚æ¨¡å¼ + ç­–ç•¥æ¨¡å¼å®ç°å¯é…ç½®çš„ç®—æ³•é€‰æ‹©å™¨</p><h3 id="5-è®¾è®¡æ¨¡å¼çš„æ€§èƒ½è€ƒè™‘"><a href="#5-è®¾è®¡æ¨¡å¼çš„æ€§èƒ½è€ƒè™‘" class="headerlink" title="5. è®¾è®¡æ¨¡å¼çš„æ€§èƒ½è€ƒè™‘"></a>5. è®¾è®¡æ¨¡å¼çš„æ€§èƒ½è€ƒè™‘</h3><p><strong>ç»éªŒ</strong>ï¼šé€‰æ‹©è®¾è®¡æ¨¡å¼æ—¶éœ€è¦è€ƒè™‘æ€§èƒ½å½±å“<br><strong>ä¼˜åŒ–</strong>ï¼šå¯¹è±¡æ± ã€ç¼“å­˜ã€å»¶è¿Ÿåˆå§‹åŒ–ç­‰æŠ€æœ¯æå‡æ€§èƒ½</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶å·¥ç¨‹çš„é‡è¦å·¥å…·ï¼Œä½†ä¸æ˜¯é“¶å¼¹ï¼š</p><ul><li>âœ… <strong>æ­£ç¡®ä½¿ç”¨</strong>èƒ½æ˜¾è‘—æå‡ä»£ç è´¨é‡</li><li>âœ… <strong>è¿‡åº¦ä½¿ç”¨</strong>åè€Œä¼šå¢åŠ å¤æ‚æ€§</li><li>âœ… <strong>ç»“åˆå®é™…</strong>é€‰æ‹©æœ€é€‚åˆçš„è§£å†³æ–¹æ¡ˆ</li><li>âœ… <strong>æŒç»­å­¦ä¹ </strong>æ·±å…¥ç†è§£æ¯ä¸ªæ¨¡å¼çš„é€‚ç”¨åœºæ™¯</li></ul><p>æŒæ¡è®¾è®¡æ¨¡å¼ï¼Œè®©ä½ çš„ä»£ç æ›´ä¼˜é›…ã€æ›´çµæ´»ã€æ›´æ˜“äºç»´æŠ¤ã€‚è®°ä½ï¼š<strong>æœ€å¥½çš„è®¾è®¡æ˜¯é‚£äº›ä½ ä¸éœ€è¦çš„è®¾è®¡</strong>ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Architecture</category>
      
      <category>æ¶æ„è®¾è®¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
      <tag>SOLIDåŸåˆ™</tag>
      
      <tag>è½¯ä»¶æ¶æ„</tag>
      
      <tag>è®¾è®¡åŸåˆ™</tag>
      
      <tag>å·¥ç¨‹åŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android å¯åŠ¨ä¼˜åŒ–å®Œæ•´æ‹†è§£</title>
    <link href="/2025/12/18/android/Android-%E5%90%AF%E5%8A%A8%E4%BC%98%E5%8C%96%E5%85%A8%E6%B5%81%E7%A8%8B.html"/>
    <url>/2025/12/18/android/Android-%E5%90%AF%E5%8A%A8%E4%BC%98%E5%8C%96%E5%85%A8%E6%B5%81%E7%A8%8B.html</url>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯-é—®é¢˜"><a href="#èƒŒæ™¯-é—®é¢˜" class="headerlink" title="èƒŒæ™¯ &amp; é—®é¢˜"></a>èƒŒæ™¯ &amp; é—®é¢˜</h2><p>åº”ç”¨å¯åŠ¨é€Ÿåº¦æ˜¯ç”¨æˆ·ä½“éªŒçš„å…³é”®æŒ‡æ ‡ã€‚æ ¹æ®ç»Ÿè®¡ï¼Œåº”ç”¨å¯åŠ¨æ—¶é—´æ¯å¢åŠ 1ç§’ï¼Œç”¨æˆ·æµå¤±ç‡å°±ä¼šæ˜¾è‘—ä¸Šå‡ã€‚æœ¬æ–‡å°†ç³»ç»Ÿæ€§åœ°åˆ†æAndroidåº”ç”¨å¯åŠ¨çš„å®Œæ•´æµç¨‹ï¼Œå¹¶æä¾›å…¨é¢çš„ä¼˜åŒ–æ–¹æ¡ˆã€‚</p><h2 id="ç»“è®ºå…ˆè¡Œï¼ˆTL-DRï¼‰"><a href="#ç»“è®ºå…ˆè¡Œï¼ˆTL-DRï¼‰" class="headerlink" title="ç»“è®ºå…ˆè¡Œï¼ˆTL;DRï¼‰"></a>ç»“è®ºå…ˆè¡Œï¼ˆTL;DRï¼‰</h2><p>Androidå¯åŠ¨ä¼˜åŒ–éœ€è¦ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å…¥æ‰‹ï¼š</p><ol><li><strong>Applicationä¼˜åŒ–</strong>ï¼šå‡å°‘åˆå§‹åŒ–å·¥ä½œï¼Œé‡‡ç”¨æ‡’åŠ è½½</li><li><strong>Activityä¼˜åŒ–</strong>ï¼šä¼˜åŒ– onCreate æµç¨‹ï¼Œå‡å°‘å¸ƒå±€å±‚çº§</li><li><strong>çº¿ç¨‹ä¼˜åŒ–</strong>ï¼šåˆç†ä½¿ç”¨çº¿ç¨‹ï¼Œé¿å…ä¸»çº¿ç¨‹é˜»å¡</li><li><strong>èµ„æºä¼˜åŒ–</strong>ï¼šå‹ç¼©èµ„æºï¼Œå‡å°‘IOæ“ä½œ</li><li><strong>ç³»ç»Ÿçº§ä¼˜åŒ–</strong>ï¼šåˆ©ç”¨ç³»ç»Ÿæœºåˆ¶ï¼Œæå‡å¯åŠ¨é€Ÿåº¦</li></ol><h2 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h2><h3 id="å¯åŠ¨æµç¨‹åˆ†æ"><a href="#å¯åŠ¨æµç¨‹åˆ†æ" class="headerlink" title="å¯åŠ¨æµç¨‹åˆ†æ"></a>å¯åŠ¨æµç¨‹åˆ†æ</h3><p>Androidåº”ç”¨å¯åŠ¨åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><h4 id="1-è¿›ç¨‹åˆ›å»ºé˜¶æ®µ"><a href="#1-è¿›ç¨‹åˆ›å»ºé˜¶æ®µ" class="headerlink" title="1. è¿›ç¨‹åˆ›å»ºé˜¶æ®µ"></a>1. è¿›ç¨‹åˆ›å»ºé˜¶æ®µ</h4><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs xl"><span class="hljs-function"><span class="hljs-title">zygote</span> fork -&gt;</span> <span class="hljs-function"><span class="hljs-title"><code class="language-hljs xl"><span class="hljs-function"><span class="hljs-title">zygote</span> fork -&gt;</span> <span class="hljs-function"><span class="hljs-title">handleBindApplication</span> -></span> Application.onCreate<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h4 id="2-Activityå¯åŠ¨é˜¶æ®µ"><a href="#2-Activityå¯åŠ¨é˜¶æ®µ" class="headerlink" title="2. Activityå¯åŠ¨é˜¶æ®µ"></a>2. Activityå¯åŠ¨é˜¶æ®µ</h4><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs xl">AMS -&gt; A<span class="hljs-function"><span class="hljs-title">ctivityThread</span> -&gt;</span> A<span class="hljs-function"><span class="hljs-title"><code class="language-hljs xl">AMS -&gt; A<span class="hljs-function"><span class="hljs-title">ctivityThread</span> -&gt;</span> A<span class="hljs-function"><span class="hljs-title">ctivity</span>.onCreate -></span> onResume<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h4 id="3-é¦–å¸§æ¸²æŸ“é˜¶æ®µ"><a href="#3-é¦–å¸§æ¸²æŸ“é˜¶æ®µ" class="headerlink" title="3. é¦–å¸§æ¸²æŸ“é˜¶æ®µ"></a>3. é¦–å¸§æ¸²æŸ“é˜¶æ®µ</h4><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs xl">C<span class="hljs-function"><span class="hljs-title">horeographer</span> -&gt;</span> <span class="hljs-function"><span class="hljs-title">measure</span> -&gt;</span> <span class="hljs-function"><span class="hljs-title"><code class="language-hljs xl">C<span class="hljs-function"><span class="hljs-title">horeographer</span> -&gt;</span> <span class="hljs-function"><span class="hljs-title">measure</span> -&gt;</span> <span class="hljs-function"><span class="hljs-title">layout</span> -></span> draw<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="æ€§èƒ½ç“¶é¢ˆè¯†åˆ«"><a href="#æ€§èƒ½ç“¶é¢ˆè¯†åˆ«" class="headerlink" title="æ€§èƒ½ç“¶é¢ˆè¯†åˆ«"></a>æ€§èƒ½ç“¶é¢ˆè¯†åˆ«</h3><p>é€šè¿‡ Systrace å’Œ Perfetto åˆ†æï¼Œå¸¸è§çš„æ€§èƒ½ç“¶é¢ˆåŒ…æ‹¬ï¼š</p><ol><li><strong>ä¸»çº¿ç¨‹é˜»å¡</strong>ï¼šåŒæ­¥IOæ“ä½œã€å¤æ‚è®¡ç®—</li><li><strong>å¸ƒå±€è¿‡åº¦ç»˜åˆ¶</strong>ï¼šä¸å¿…è¦çš„å¸ƒå±€åµŒå¥—</li><li><strong>èµ„æºåŠ è½½ç¼“æ…¢</strong>ï¼šå¤§å›¾ç‰‡ã€è¿‡å¤šçš„èµ„æºæ–‡ä»¶</li><li><strong>åå°„è°ƒç”¨</strong>ï¼šå¤§é‡åå°„æ“ä½œå½±å“æ€§èƒ½</li></ol><h2 id="å®ç°æ–¹æ¡ˆ"><a href="#å®ç°æ–¹æ¡ˆ" class="headerlink" title="å®ç°æ–¹æ¡ˆ"></a>å®ç°æ–¹æ¡ˆ</h2><h3 id="1-Applicationä¼˜åŒ–"><a href="#1-Applicationä¼˜åŒ–" class="headerlink" title="1. Applicationä¼˜åŒ–"></a>1. Applicationä¼˜åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Application</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isInitCompleted</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate();<br>        <br>        <span class="hljs-comment">// å¼‚æ­¥åˆå§‹åŒ–éå¿…è¦ç»„ä»¶</span><br>        Executors.newSingleThreadExecutor().execute(() -&gt; &#123;<br>            initNonCriticalComponents();<br>            isInitCompleted = <span class="hljs-literal">true</span>;<br>        &#125;);<br>        <br>        <span class="hljs-comment">// ä¸»çº¿ç¨‹åªåˆå§‹åŒ–å…³é”®ç»„ä»¶</span><br>        initCriticalComponents();<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initCriticalComponents</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// åªåˆå§‹åŒ–å¿…é¡»çš„ç»„ä»¶</span><br>        LeakCanary.install(<span class="hljs-built_in">this</span>);<br>        <span class="hljs-comment">// å…¶ä»–å…³é”®åˆå§‹åŒ–...</span><br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initNonCriticalComponents</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// åˆå§‹åŒ–éå…³é”®ç»„ä»¶</span><br>        UMConfigure.init(<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;appkey&quot;</span>, <span class="hljs-string">&quot;channel&quot;</span>, UMConfigure.DEVICE_TYPE_PHONE, <span class="hljs-literal">null</span>);<br>        <span class="hljs-comment"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Application</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isInitCompleted</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate();<br>        <br>        <span class="hljs-comment">// å¼‚æ­¥åˆå§‹åŒ–éå¿…è¦ç»„ä»¶</span><br>        Executors.newSingleThreadExecutor().execute(() -&gt; &#123;<br>            initNonCriticalComponents();<br>            isInitCompleted = <span class="hljs-literal">true</span>;<br>        &#125;);<br>        <br>        <span class="hljs-comment">// ä¸»çº¿ç¨‹åªåˆå§‹åŒ–å…³é”®ç»„ä»¶</span><br>        initCriticalComponents();<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initCriticalComponents</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// åªåˆå§‹åŒ–å¿…é¡»çš„ç»„ä»¶</span><br>        LeakCanary.install(<span class="hljs-built_in">this</span>);<br>        <span class="hljs-comment">// å…¶ä»–å…³é”®åˆå§‹åŒ–...</span><br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initNonCriticalComponents</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// åˆå§‹åŒ–éå…³é”®ç»„ä»¶</span><br>        UMConfigure.init(<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;appkey&quot;</span>, <span class="hljs-string">&quot;channel&quot;</span>, UMConfigure.DEVICE_TYPE_PHONE, <span class="hljs-literal">null</span>);<br>        <span class="hljs-comment">// å…¶ä»–éå…³é”®åˆå§‹åŒ–...</span><br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="2-Activityä¼˜åŒ–"><a href="#2-Activityä¼˜åŒ–" class="headerlink" title="2. Activityä¼˜åŒ–"></a>2. Activityä¼˜åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        <br>        <span class="hljs-comment">// ä½¿ç”¨ ViewBinding å‡å°‘findViewById</span><br>        <span class="hljs-type">ActivityMainBinding</span> <span class="hljs-variable">binding</span> <span class="hljs-operator">=</span> <br>            ActivityMainBinding.inflate(getLayoutInflater());<br>        setContentView(binding.getRoot());<br>        <br>        <span class="hljs-comment">// å»¶è¿ŸåŠ è½½éå…³é”®æ•°æ®</span><br>        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;<br>            getMainThread().postDelayed(<span class="hljs-built_in">this</span>::loadNonCriticalData, <span class="hljs-number">300</span>);<br>        &#125;<br>        <br>        <span class="hljs-comment">// å¼‚æ­¥åŠ è½½æ•°æ®</span><br>        loadCriticalDataAsync();<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadCriticalDataAsync</span><span class="hljs-params">()</span> &#123;<br>        CompletableFuture.runAsync(() -&gt; &#123;<br>            <span class="hljs-comment">// åœ¨åå°çº¿ç¨‹åŠ è½½æ•°æ®</span><br>            <span class="hljs-type">Data</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> loadFromNetwork();<br>            <span class="hljs-comment"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        <br>        <span class="hljs-comment">// ä½¿ç”¨ ViewBinding å‡å°‘findViewById</span><br>        <span class="hljs-type">ActivityMainBinding</span> <span class="hljs-variable">binding</span> <span class="hljs-operator">=</span> <br>            ActivityMainBinding.inflate(getLayoutInflater());<br>        setContentView(binding.getRoot());<br>        <br>        <span class="hljs-comment">// å»¶è¿ŸåŠ è½½éå…³é”®æ•°æ®</span><br>        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;<br>            getMainThread().postDelayed(<span class="hljs-built_in">this</span>::loadNonCriticalData, <span class="hljs-number">300</span>);<br>        &#125;<br>        <br>        <span class="hljs-comment">// å¼‚æ­¥åŠ è½½æ•°æ®</span><br>        loadCriticalDataAsync();<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadCriticalDataAsync</span><span class="hljs-params">()</span> &#123;<br>        CompletableFuture.runAsync(() -&gt; &#123;<br>            <span class="hljs-comment">// åœ¨åå°çº¿ç¨‹åŠ è½½æ•°æ®</span><br>            <span class="hljs-type">Data</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> loadFromNetwork();<br>            <span class="hljs-comment">// åˆ‡æ¢å›ä¸»çº¿ç¨‹æ›´æ–°UI</span><br>            runOnUiThread(() -> updateUI(data));<br>        &#125;);<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="3-å¸ƒå±€ä¼˜åŒ–"><a href="#3-å¸ƒå±€ä¼˜åŒ–" class="headerlink" title="3. å¸ƒå±€ä¼˜åŒ–"></a>3. å¸ƒå±€ä¼˜åŒ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs xml"><span class="hljs-comment">&lt;!-- ä½¿ç”¨ ConstraintLayout å‡å°‘å±‚çº§ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">androidx.constraintlayout.widget.ConstraintLayout</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:app</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span>&gt;</span><br>    <br>    <span class="hljs-comment">&lt;!-- é¿å…ä¸å¿…è¦çš„åµŒå¥— --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ImageView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/avatar&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;48dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;48dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintStart_toStartOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">&quot;parent&quot;</span> /&gt;</span><br>        <br>    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/title&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;0dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginStart</span>=<span class="hljs-string">&quot;8dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintStart_toEndOf</span>=<span class="hljs-string">&quot;@id/avatar&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintEnd_toEndOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">&quot;@id/avatar&quot;</span> /&gt;</span><br>        <br><span class="hljs-tag">&lt;/<span class="hljs-name"><code class="language-hljs xml"><span class="hljs-comment">&lt;!-- ä½¿ç”¨ ConstraintLayout å‡å°‘å±‚çº§ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">androidx.constraintlayout.widget.ConstraintLayout</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:app</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span>&gt;</span><br>    <br>    <span class="hljs-comment">&lt;!-- é¿å…ä¸å¿…è¦çš„åµŒå¥— --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ImageView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/avatar&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;48dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;48dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintStart_toStartOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">&quot;parent&quot;</span> /&gt;</span><br>        <br>    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/title&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;0dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginStart</span>=<span class="hljs-string">&quot;8dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintStart_toEndOf</span>=<span class="hljs-string">&quot;@id/avatar&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintEnd_toEndOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">&quot;@id/avatar&quot;</span> /&gt;</span><br>        <br><span class="hljs-tag">&lt;/<span class="hljs-name">androidx.constraintlayout.widget.ConstraintLayout</span>></span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="æ ¸å¿ƒä»£ç "><a href="#æ ¸å¿ƒä»£ç " class="headerlink" title="æ ¸å¿ƒä»£ç "></a>æ ¸å¿ƒä»£ç </h2><h3 id="å¯åŠ¨æ—¶é—´ç›‘æ§"><a href="#å¯åŠ¨æ—¶é—´ç›‘æ§" class="headerlink" title="å¯åŠ¨æ—¶é—´ç›‘æ§"></a>å¯åŠ¨æ—¶é—´ç›‘æ§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StartupMonitor</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> sStartTime;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startMonitoring</span><span class="hljs-params">()</span> &#123;<br>        sStartTime = System.currentTimeMillis();<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordEvent</span><span class="hljs-params">(String eventName)</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">currentTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> currentTime - sStartTime;<br>        Log.d(<span class="hljs-string">&quot;StartupMonitor&quot;</span>, eventName + <span class="hljs-string">&quot;: &quot;</span> + duration + <span class="hljs-string">&quot;ms&quot;</span>);<br>        <br>        <span class="hljs-comment">// ä¸ŠæŠ¥åˆ°ç›‘æ§ç³»ç»Ÿ</span><br>        <span class="hljs-keyword">if</span> (duration &gt; <span class="hljs-number">100</span>) &#123; <span class="hljs-comment"><code class="language-hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StartupMonitor</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> sStartTime;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startMonitoring</span><span class="hljs-params">()</span> &#123;<br>        sStartTime = System.currentTimeMillis();<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordEvent</span><span class="hljs-params">(String eventName)</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">currentTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> currentTime - sStartTime;<br>        Log.d(<span class="hljs-string">&quot;StartupMonitor&quot;</span>, eventName + <span class="hljs-string">&quot;: &quot;</span> + duration + <span class="hljs-string">&quot;ms&quot;</span>);<br>        <br>        <span class="hljs-comment">// ä¸ŠæŠ¥åˆ°ç›‘æ§ç³»ç»Ÿ</span><br>        <span class="hljs-keyword">if</span> (duration &gt; <span class="hljs-number">100</span>) &#123; <span class="hljs-comment">// è¶…è¿‡100msçš„äº‹ä»¶</span><br>            Analytics.track(eventName, duration);<br>        &#125;<br>    &#125;<br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="èµ„æºå‹ç¼©é…ç½®"><a href="#èµ„æºå‹ç¼©é…ç½®" class="headerlink" title="èµ„æºå‹ç¼©é…ç½®"></a>èµ„æºå‹ç¼©é…ç½®</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs gradle">android &#123;<br>    buildTypes &#123;<br>        release &#123;<br>            minifyEnabled <span class="hljs-keyword">true</span><br>            shrinkResources <span class="hljs-keyword">true</span><br>            <br>            <span class="hljs-comment">// èµ„æºå‹ç¼©</span><br>            crunchPngs <span class="hljs-keyword">true</span><br>            <br>            <span class="hljs-comment">// å¯ç”¨R8ä¼˜åŒ–</span><br>            proguardFiles getDefaultProguardFile(<span class="hljs-string">&#x27;proguard-android-optimize.txt&#x27;</span>),<br>                          <span class="hljs-string">&#x27;proguard-rules.pro&#x27;</span><br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// çŸ¢é‡å›¾æ”¯æŒ</span><br>    vectorDrawables.useSupportLibrary = <span class="hljs-keyword">true</span><br>&#125;<br><br><span class="hljs-keyword">dependencies</span> &#123;<br>    <span class="hljs-comment">// ä½¿ç”¨WebPæ ¼å¼å›¾ç‰‡</span><br>    implementation <span class="hljs-string"><code class="language-hljs gradle">android &#123;<br>    buildTypes &#123;<br>        release &#123;<br>            minifyEnabled <span class="hljs-keyword">true</span><br>            shrinkResources <span class="hljs-keyword">true</span><br>            <br>            <span class="hljs-comment">// èµ„æºå‹ç¼©</span><br>            crunchPngs <span class="hljs-keyword">true</span><br>            <br>            <span class="hljs-comment">// å¯ç”¨R8ä¼˜åŒ–</span><br>            proguardFiles getDefaultProguardFile(<span class="hljs-string">&#x27;proguard-android-optimize.txt&#x27;</span>),<br>                          <span class="hljs-string">&#x27;proguard-rules.pro&#x27;</span><br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// çŸ¢é‡å›¾æ”¯æŒ</span><br>    vectorDrawables.useSupportLibrary = <span class="hljs-keyword">true</span><br>&#125;<br><br><span class="hljs-keyword">dependencies</span> &#123;<br>    <span class="hljs-comment">// ä½¿ç”¨WebPæ ¼å¼å›¾ç‰‡</span><br>    implementation <span class="hljs-string">&#x27;androidx.webkit:webkit:1.8.0&#x27;</span><br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="å¸¸è§å‘"><a href="#å¸¸è§å‘" class="headerlink" title="å¸¸è§å‘"></a>å¸¸è§å‘</h2><h3 id="1-è¿‡æ—©ä¼˜åŒ–"><a href="#1-è¿‡æ—©ä¼˜åŒ–" class="headerlink" title="1. è¿‡æ—©ä¼˜åŒ–"></a>1. è¿‡æ—©ä¼˜åŒ–</h3><p><strong>é—®é¢˜</strong>ï¼šåœ¨æ²¡æœ‰æ˜ç¡®æ€§èƒ½ç“¶é¢ˆçš„æƒ…å†µä¸‹è¿›è¡Œè¿‡åº¦ä¼˜åŒ–ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li>å…ˆç”¨ Systrace æ‰¾å‡ºçœŸæ­£çš„ç“¶é¢ˆ</li><li>ä¼˜å…ˆä¼˜åŒ–å½±å“æœ€å¤§çš„é—®é¢˜</li><li>å»ºç«‹æ€§èƒ½ç›‘æ§ä½“ç³»</li></ul><h3 id="2-å¤šçº¿ç¨‹æ»¥ç”¨"><a href="#2-å¤šçº¿ç¨‹æ»¥ç”¨" class="headerlink" title="2. å¤šçº¿ç¨‹æ»¥ç”¨"></a>2. å¤šçº¿ç¨‹æ»¥ç”¨</h3><p><strong>é—®é¢˜</strong>ï¼šä¸ºäº†ä¼˜åŒ–è€Œæ»¥ç”¨å¤šçº¿ç¨‹ï¼Œå¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li>åˆç†ä½¿ç”¨çº¿ç¨‹æ± </li><li>æ³¨æ„çº¿ç¨‹é—´é€šä¿¡</li><li>é¿å…å†…å­˜æ³„æ¼</li></ul><h3 id="3-ç”¨æˆ·ä½“éªŒå¿½ç•¥"><a href="#3-ç”¨æˆ·ä½“éªŒå¿½ç•¥" class="headerlink" title="3. ç”¨æˆ·ä½“éªŒå¿½ç•¥"></a>3. ç”¨æˆ·ä½“éªŒå¿½ç•¥</h3><p><strong>é—®é¢˜</strong>ï¼šåªè¿½æ±‚å¯åŠ¨é€Ÿåº¦ï¼Œå¿½ç•¥äº†ç”¨æˆ·ä½“éªŒã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li>æä¾›å¯åŠ¨ç”»é¢</li><li>åˆç†çš„åŠ è½½åŠ¨ç”»</li><li>æ¸è¿›å¼å†…å®¹åŠ è½½</li></ul><h2 id="å¯è¿ç§»ç»éªŒ"><a href="#å¯è¿ç§»ç»éªŒ" class="headerlink" title="å¯è¿ç§»ç»éªŒ"></a>å¯è¿ç§»ç»éªŒ</h2><ol><li><strong>ç›‘æ§å…ˆè¡Œ</strong>ï¼šå»ºç«‹å®Œå–„çš„æ€§èƒ½ç›‘æ§ä½“ç³»</li><li><strong>æ¸è¿›ä¼˜åŒ–</strong>ï¼šåˆ†é˜¶æ®µè¿›è¡Œä¼˜åŒ–ï¼Œæ¯æ¬¡è§£å†³ä¸€ä¸ªé—®é¢˜</li><li><strong>ç”¨æˆ·å¯¼å‘</strong>ï¼šä¼˜åŒ–è¦ä»¥ç”¨æˆ·ä½“éªŒä¸ºç›®æ ‡</li><li><strong>æŒç»­æ”¹è¿›</strong>ï¼šæ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹</li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¯åŠ¨ä¼˜åŒ–æ˜¯ä¸€ä¸ªç³»ç»Ÿå·¥ç¨‹ï¼Œéœ€è¦ä»åº”ç”¨æ¶æ„ã€ä»£ç å®ç°ã€èµ„æºç®¡ç†ç­‰å¤šä¸ªç»´åº¦è¿›è¡Œè€ƒè™‘ã€‚é€šè¿‡æœ¬æ–‡çš„æ–¹æ¡ˆï¼Œå¯ä»¥å°†åº”ç”¨å¯åŠ¨æ—¶é—´å‡å°‘30-50%ï¼Œæ˜¾è‘—æå‡ç”¨æˆ·ä½“éªŒã€‚</p><p>è®°ä½ï¼š<strong>è¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æºï¼Œä½†æ²¡æœ‰ä¼˜åŒ–æ›´æ˜¯ä¸‡æ¶ä¹‹æº</strong>ã€‚å»ºç«‹ç›‘æ§ï¼Œæ‰¾åˆ°ç“¶é¢ˆï¼Œé€æ­¥ä¼˜åŒ–ï¼Œè¿™æ‰æ˜¯å¯åŠ¨ä¼˜åŒ–çš„æ­£ç¡®è·¯å¾„ã€‚</p><blockquote><p>å¯åŠ¨é€Ÿåº¦ä¸æ˜¯ç»ˆæç›®æ ‡ï¼Œç”¨æˆ·ä½“éªŒæ‰æ˜¯ã€‚åœ¨è¿½æ±‚æ€§èƒ½çš„åŒæ—¶ï¼Œä¸è¦å¿˜è®°äº§å“çš„æ ¸å¿ƒä»·å€¼ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>æ€§èƒ½ä¼˜åŒ–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å†·å¯åŠ¨</tag>
      
      <tag>AMS</tag>
      
      <tag>æ€§èƒ½åˆ†æ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidç¾¤è‹±ä¼  ç¥å…µåˆ©å™¨ç¬”è®°</title>
    <link href="/2016/12/22/android/Android%E7%BE%A4%E8%8B%B1%E4%BC%A0-%E7%A5%9E%E5%85%B5%E5%88%A9%E5%99%A8%E7%AC%94%E8%AE%B0.html"/>
    <url>/2016/12/22/android/Android%E7%BE%A4%E8%8B%B1%E4%BC%A0-%E7%A5%9E%E5%85%B5%E5%88%A9%E5%99%A8%E7%AC%94%E8%AE%B0.html</url>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯-é—®é¢˜"><a href="#èƒŒæ™¯-é—®é¢˜" class="headerlink" title="èƒŒæ™¯ &amp; é—®é¢˜"></a>èƒŒæ™¯ &amp; é—®é¢˜</h2><p>ã€ŠAndroidç¾¤è‹±ä¼ ï¼šç¥å…µåˆ©å™¨ã€‹æ˜¯Androidå¼€å‘é¢†åŸŸçš„ç»å…¸ä¹¦ç±ï¼Œä»‹ç»äº†Androidå¼€å‘è¿‡ç¨‹ä¸­å„ç§å¼ºå¤§çš„å·¥å…·å’Œåº“ã€‚åœ¨é˜…è¯»è¿‡ç¨‹ä¸­ï¼Œæˆ‘è®°å½•äº†ä¸€äº›é‡è¦çš„çŸ¥è¯†ç‚¹å’Œå®ç”¨å·¥å…·ï¼Œå¸Œæœ›åˆ†äº«ç»™å¤§å®¶ã€‚</p><h2 id="ç»“è®ºå…ˆè¡Œï¼ˆTL-DRï¼‰"><a href="#ç»“è®ºå…ˆè¡Œï¼ˆTL-DRï¼‰" class="headerlink" title="ç»“è®ºå…ˆè¡Œï¼ˆTL;DRï¼‰"></a>ç»“è®ºå…ˆè¡Œï¼ˆTL;DRï¼‰</h2><p>æœ¬ä¹¦æ¶µç›–äº†Androidå¼€å‘å·¥å…·é“¾çš„æ–¹æ–¹é¢é¢ï¼Œä»å¼€å‘ç¯å¢ƒæ­å»ºåˆ°æ€§èƒ½åˆ†æï¼Œä»ç‰ˆæœ¬æ§åˆ¶åˆ°è‡ªåŠ¨åŒ–æ„å»ºï¼Œæ˜¯æ¯ä¸ªAndroidå¼€å‘è€…å¿…å¤‡çš„å·¥å…·å‚è€ƒä¹¦ã€‚</p><h2 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h2><h3 id="å¼€å‘å·¥å…·ä½“ç³»"><a href="#å¼€å‘å·¥å…·ä½“ç³»" class="headerlink" title="å¼€å‘å·¥å…·ä½“ç³»"></a>å¼€å‘å·¥å…·ä½“ç³»</h3><p>Androidå¼€å‘å·¥å…·å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªå±‚æ¬¡ï¼š</p><ol><li><strong>IDEå±‚</strong>ï¼šAndroid Studioã€IntelliJ IDEA</li><li><strong>æ„å»ºå·¥å…·å±‚</strong>ï¼šGradleã€Maven</li><li><strong>è°ƒè¯•å·¥å…·å±‚</strong>ï¼šADBã€DDMSã€Memory Profiler</li><li><strong>æµ‹è¯•å·¥å…·å±‚</strong>ï¼šJUnitã€Espressoã€Robolectric</li><li><strong>æ€§èƒ½åˆ†æå±‚</strong>ï¼šSystraceã€Traceviewã€GPU Profiler</li></ol><h3 id="å·¥å…·é€‰æ‹©åŸåˆ™"><a href="#å·¥å…·é€‰æ‹©åŸåˆ™" class="headerlink" title="å·¥å…·é€‰æ‹©åŸåˆ™"></a>å·¥å…·é€‰æ‹©åŸåˆ™</h3><p>é€‰æ‹©åˆé€‚çš„å¼€å‘å·¥å…·éœ€è¦è€ƒè™‘ä»¥ä¸‹å› ç´ ï¼š</p><ul><li><strong>é¡¹ç›®è§„æ¨¡</strong>ï¼šå¤§å‹é¡¹ç›®éœ€è¦æ›´å¼ºçš„æ„å»ºå·¥å…·</li><li><strong>å›¢é˜Ÿåä½œ</strong>ï¼šè€ƒè™‘å·¥å…·çš„åä½œç‰¹æ€§</li><li><strong>æ€§èƒ½è¦æ±‚</strong>ï¼šæ€§èƒ½åˆ†æå·¥å…·çš„ç²¾ç¡®åº¦</li><li><strong>å­¦ä¹ æˆæœ¬</strong>ï¼šå·¥å…·çš„å­¦ä¹ æ›²çº¿</li></ul><h2 id="å®ç°æ–¹æ¡ˆ"><a href="#å®ç°æ–¹æ¡ˆ" class="headerlink" title="å®ç°æ–¹æ¡ˆ"></a>å®ç°æ–¹æ¡ˆ</h2><h3 id="æ¨èå·¥å…·é…ç½®"><a href="#æ¨èå·¥å…·é…ç½®" class="headerlink" title="æ¨èå·¥å…·é…ç½®"></a>æ¨èå·¥å…·é…ç½®</h3><h4 id="å¼€å‘ç¯å¢ƒé…ç½®"><a href="#å¼€å‘ç¯å¢ƒé…ç½®" class="headerlink" title="å¼€å‘ç¯å¢ƒé…ç½®"></a>å¼€å‘ç¯å¢ƒé…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs bash"><span class="hljs-comment"># å®‰è£…Android Studio</span><br>wget https://dl.google.com/dl/android/studio/ide-zips/3.5.3.0/android-studio-ide-191.6010548-linux.tar.gz<br><br><span class="hljs-comment"><code class="language-hljs bash"><span class="hljs-comment"># å®‰è£…Android Studio</span><br>wget https://dl.google.com/dl/android/studio/ide-zips/3.5.3.0/android-studio-ide-191.6010548-linux.tar.gz<br><br><span class="hljs-comment"># é…ç½®Gradle</span><br>distributionBase=GRADLE_USER_HOME<br>distributionPath=wrapper/dists<br>distributionUrl=https\://services.gradle.org/distributions/gradle-5.4.1-all.zip<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h4 id="æ€§èƒ½åˆ†æå·¥å…·ä½¿ç”¨"><a href="#æ€§èƒ½åˆ†æå·¥å…·ä½¿ç”¨" class="headerlink" title="æ€§èƒ½åˆ†æå·¥å…·ä½¿ç”¨"></a>æ€§èƒ½åˆ†æå·¥å…·ä½¿ç”¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs bash"><span class="hljs-comment"># ä½¿ç”¨Systraceè¿›è¡Œæ€§èƒ½åˆ†æ</span><br>python <span class="hljs-variable">$ANDROID_HOME</span>/platform-tools/systrace/systrace.py -t 10 -o trace.html gfx view wm am input<br><br><span class="hljs-comment"><code class="language-hljs bash"><span class="hljs-comment"># ä½¿ç”¨Systraceè¿›è¡Œæ€§èƒ½åˆ†æ</span><br>python <span class="hljs-variable">$ANDROID_HOME</span>/platform-tools/systrace/systrace.py -t 10 -o trace.html gfx view wm am input<br><br><span class="hljs-comment"># ä½¿ç”¨ADBå‘½ä»¤æŸ¥çœ‹å†…å­˜ä½¿ç”¨</span><br>adb shell dumpsys meminfo com.example.app<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="æ ¸å¿ƒä»£ç "><a href="#æ ¸å¿ƒä»£ç " class="headerlink" title="æ ¸å¿ƒä»£ç "></a>æ ¸å¿ƒä»£ç </h2><h4 id="Gradleæ„å»ºè„šæœ¬ä¼˜åŒ–"><a href="#Gradleæ„å»ºè„šæœ¬ä¼˜åŒ–" class="headerlink" title="Gradleæ„å»ºè„šæœ¬ä¼˜åŒ–"></a>Gradleæ„å»ºè„šæœ¬ä¼˜åŒ–</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs groovy">android &#123;<br>    compileSdkVersion <span class="hljs-number">29</span><br>    buildToolsVersion <span class="hljs-string">&quot;29.0.2&quot;</span><br>    <br>    defaultConfig &#123;<br>        applicationId <span class="hljs-string">&quot;com.example.app&quot;</span><br>        minSdkVersion <span class="hljs-number">21</span><br>        targetSdkVersion <span class="hljs-number">29</span><br>        versionCode <span class="hljs-number">1</span><br>        versionName <span class="hljs-string">&quot;1.0&quot;</span><br>        <br>        <span class="hljs-comment">// å¯ç”¨å¤šdexæ”¯æŒ</span><br>        multiDexEnabled <span class="hljs-literal">true</span><br>    &#125;<br>    <br>    buildTypes &#123;<br>        release &#123;<br>            minifyEnabled <span class="hljs-literal">true</span><br>            proguardFiles getDefaultProguardFile(<span class="hljs-string">&#x27;proguard-android.txt&#x27;</span>), <span class="hljs-string">&#x27;proguard-rules.pro&#x27;</span><br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// ç¼–è¯‘ä¼˜åŒ–</span><br>    compileOptions &#123;<br>        sourceCompatibility JavaVersion.VERSION_1_8<br>        targetCompatibility JavaVersion.VERSION_1_8<br>    &#125;<br>&#125;<br><br>dependencies &#123;<br>    implementation <span class="hljs-string">&#x27;androidx.appcompat:appcompat:1.1.0&#x27;</span><br>    implementation <span class="hljs-string">&#x27;com.google.android.material:material:1.0.0&#x27;</span><br>    <br>    <span class="hljs-comment">// æ€§èƒ½ä¼˜åŒ–åº“</span><br>    implementation <span class="hljs-string"><code class="language-hljs groovy">android &#123;<br>    compileSdkVersion <span class="hljs-number">29</span><br>    buildToolsVersion <span class="hljs-string">&quot;29.0.2&quot;</span><br>    <br>    defaultConfig &#123;<br>        applicationId <span class="hljs-string">&quot;com.example.app&quot;</span><br>        minSdkVersion <span class="hljs-number">21</span><br>        targetSdkVersion <span class="hljs-number">29</span><br>        versionCode <span class="hljs-number">1</span><br>        versionName <span class="hljs-string">&quot;1.0&quot;</span><br>        <br>        <span class="hljs-comment">// å¯ç”¨å¤šdexæ”¯æŒ</span><br>        multiDexEnabled <span class="hljs-literal">true</span><br>    &#125;<br>    <br>    buildTypes &#123;<br>        release &#123;<br>            minifyEnabled <span class="hljs-literal">true</span><br>            proguardFiles getDefaultProguardFile(<span class="hljs-string">&#x27;proguard-android.txt&#x27;</span>), <span class="hljs-string">&#x27;proguard-rules.pro&#x27;</span><br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// ç¼–è¯‘ä¼˜åŒ–</span><br>    compileOptions &#123;<br>        sourceCompatibility JavaVersion.VERSION_1_8<br>        targetCompatibility JavaVersion.VERSION_1_8<br>    &#125;<br>&#125;<br><br>dependencies &#123;<br>    implementation <span class="hljs-string">&#x27;androidx.appcompat:appcompat:1.1.0&#x27;</span><br>    implementation <span class="hljs-string">&#x27;com.google.android.material:material:1.0.0&#x27;</span><br>    <br>    <span class="hljs-comment">// æ€§èƒ½ä¼˜åŒ–åº“</span><br>    implementation <span class="hljs-string">&#x27;com.facebook.stetho:stetho:1.5.1&#x27;</span><br>&#125;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="å¸¸è§å‘"><a href="#å¸¸è§å‘" class="headerlink" title="å¸¸è§å‘"></a>å¸¸è§å‘</h2><h3 id="1-Gradleæ„å»ºç¼“æ…¢"><a href="#1-Gradleæ„å»ºç¼“æ…¢" class="headerlink" title="1. Gradleæ„å»ºç¼“æ…¢"></a>1. Gradleæ„å»ºç¼“æ…¢</h3><p><strong>é—®é¢˜</strong>ï¼šGradleæ„å»ºè¿‡ç¨‹å¾ˆæ…¢ï¼Œå½±å“å¼€å‘æ•ˆç‡ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li>é…ç½®Gradleå®ˆæŠ¤è¿›ç¨‹</li><li>ä½¿ç”¨æœ¬åœ°Gradleç¼“å­˜</li><li>å¯ç”¨å¹¶è¡Œæ„å»º</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs bash"><span class="hljs-comment"># gradle.properties</span><br>org.gradle.daemon=<span class="hljs-literal">true</span><br>org.gradle.parallel=<span class="hljs-literal">true</span><br>org.gradle.configureondemand=<span class="hljs-literal"><code class="language-hljs bash"><span class="hljs-comment"># gradle.properties</span><br>org.gradle.daemon=<span class="hljs-literal">true</span><br>org.gradle.parallel=<span class="hljs-literal">true</span><br>org.gradle.configureondemand=<span class="hljs-literal">true</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h3 id="2-å†…å­˜åˆ†æä¸å‡†ç¡®"><a href="#2-å†…å­˜åˆ†æä¸å‡†ç¡®" class="headerlink" title="2. å†…å­˜åˆ†æä¸å‡†ç¡®"></a>2. å†…å­˜åˆ†æä¸å‡†ç¡®</h3><p><strong>é—®é¢˜</strong>ï¼šä½¿ç”¨å†…å­˜åˆ†æå·¥å…·æ—¶å¾—åˆ°çš„æ•°æ®ä¸å‡†ç¡®ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li>å¤šæ¬¡æµ‹é‡å–å¹³å‡å€¼</li><li>ç»“åˆä»£ç åˆ†æ</li><li>ä½¿ç”¨å¤šä¸ªå·¥å…·äº¤å‰éªŒè¯</li></ul><h2 id="å¯è¿ç§»ç»éªŒ"><a href="#å¯è¿ç§»ç»éªŒ" class="headerlink" title="å¯è¿ç§»ç»éªŒ"></a>å¯è¿ç§»ç»éªŒ</h2><ol><li><strong>å·¥å…·é“¾é›†æˆ</strong>ï¼šå°†å„ç§å·¥å…·é›†æˆåˆ°å¼€å‘æµç¨‹ä¸­ï¼Œå½¢æˆå®Œæ•´çš„å·¥å…·é“¾</li><li><strong>è‡ªåŠ¨åŒ–æ„è¯†</strong>ï¼šå°½å¯èƒ½è‡ªåŠ¨åŒ–é‡å¤æ€§çš„å·¥ä½œ</li><li><strong>æ€§èƒ½ç›‘æ§</strong>ï¼šå»ºç«‹æ€§èƒ½ç›‘æ§ä½“ç³»ï¼ŒåŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜</li><li><strong>æ–‡æ¡£è®°å½•</strong>ï¼šé‡è¦å·¥å…·çš„ä½¿ç”¨è¦è®°å½•æ–‡æ¡£ï¼Œä¾¿äºå›¢é˜Ÿå…±äº«</li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æŒæ¡å¼ºå¤§çš„å¼€å‘å·¥å…·æ˜¯æå‡å¼€å‘æ•ˆç‡çš„å…³é”®ã€‚ã€ŠAndroidç¾¤è‹±ä¼ ï¼šç¥å…µåˆ©å™¨ã€‹ä¸ºæˆ‘ä»¬æä¾›äº†å·¥å…·é€‰æ‹©çš„æŒ‡å—ï¼Œä½†æ›´é‡è¦çš„æ˜¯è¦æ ¹æ®é¡¹ç›®å®é™…æƒ…å†µé€‰æ‹©åˆé€‚çš„å·¥å…·ç»„åˆã€‚</p><blockquote><p>å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼Œäº‹åŠåŠŸå€ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>è¯»ä¹¦ç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Androidç¾¤è‹±ä¼ </tag>
      
      <tag>ç¥å…µåˆ©å™¨</tag>
      
      <tag>å¼€å‘å·¥å…·</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World - æˆ‘çš„æŠ€æœ¯åšå®¢ä¹‹æ—…</title>
    <link href="/2016/12/14/engineering/Hello-World-%E6%88%91%E7%9A%84%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2%E4%B9%8B%E6%97%85.html"/>
    <url>/2016/12/14/engineering/Hello-World-%E6%88%91%E7%9A%84%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2%E4%B9%8B%E6%97%85.html</url>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯-é—®é¢˜"><a href="#èƒŒæ™¯-é—®é¢˜" class="headerlink" title="èƒŒæ™¯ &amp; é—®é¢˜"></a>èƒŒæ™¯ &amp; é—®é¢˜</h2><p>2016å¹´ï¼Œæˆ‘å†³å®šå¼€å§‹æ­å»ºè‡ªå·±çš„æŠ€æœ¯åšå®¢ã€‚å½“æ—¶çš„ç›®æ ‡å¾ˆæ˜ç¡®ï¼š</p><ul><li>è®°å½•æŠ€æœ¯å­¦ä¹ å†ç¨‹</li><li>åˆ†äº«å¼€å‘ç»éªŒ</li><li>ä¸æ›´å¤šå¼€å‘è€…äº¤æµ</li><li>å»ºç«‹ä¸ªäººæŠ€æœ¯å“ç‰Œ</li></ul><p>ç»è¿‡è°ƒç ”ï¼Œæˆ‘é€‰æ‹©äº† GitHub Pages + Hexo çš„æ–¹æ¡ˆï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€æºã€å…è´¹ã€åŠŸèƒ½å¼ºå¤§çš„é™æ€åšå®¢è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="ç»“è®ºå…ˆè¡Œï¼ˆTL-DRï¼‰"><a href="#ç»“è®ºå…ˆè¡Œï¼ˆTL-DRï¼‰" class="headerlink" title="ç»“è®ºå…ˆè¡Œï¼ˆTL;DRï¼‰"></a>ç»“è®ºå…ˆè¡Œï¼ˆTL;DRï¼‰</h2><p>ç»è¿‡å¤šå¹´çš„å‘å±•ï¼Œè¿™ä¸ªåšå®¢å·²ç»ä»ç®€å•çš„æŠ€æœ¯è®°å½•ï¼Œæ¼”å˜æˆäº†ä¸€ä¸ªå®Œæ•´çš„æŠ€æœ¯å†…å®¹ç®¡ç†ç³»ç»Ÿã€‚ç°åœ¨æŒ‰ç…§æ–°çš„æ¨¡æ¿é‡æ„ï¼Œä½¿å…¶æ›´ç¬¦åˆå·¥ç¨‹åŒ–ã€æ ‡å‡†åŒ–çš„è¦æ±‚ã€‚</p><h2 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h2><h3 id="æŠ€æœ¯é€‰å‹åˆ†æ"><a href="#æŠ€æœ¯é€‰å‹åˆ†æ" class="headerlink" title="æŠ€æœ¯é€‰å‹åˆ†æ"></a>æŠ€æœ¯é€‰å‹åˆ†æ</h3><p>é€‰æ‹© GitHub Pages + Hexo çš„åŸå› ï¼š</p><ol><li><strong>é›¶æˆæœ¬</strong>ï¼šå®Œå…¨å…è´¹ï¼Œæ— éœ€æœåŠ¡å™¨</li><li><strong>é«˜å¯ç”¨</strong>ï¼šGitHub æä¾›ç¨³å®šçš„CDNæœåŠ¡</li><li><strong>ç‰ˆæœ¬æ§åˆ¶</strong>ï¼šæ–‡ç« å’Œé…ç½®éƒ½å¯ä»¥ç‰ˆæœ¬æ§åˆ¶</li><li><strong>è‡ªåŠ¨éƒ¨ç½²</strong>ï¼šé€šè¿‡ GitHub Actions å®ç°è‡ªåŠ¨åŒ–</li><li><strong>é«˜åº¦å®šåˆ¶</strong>ï¼šä¸°å¯Œçš„ä¸»é¢˜å’Œæ’ä»¶ç”Ÿæ€</li></ol><h3 id="æ¶æ„è®¾è®¡"><a href="#æ¶æ„è®¾è®¡" class="headerlink" title="æ¶æ„è®¾è®¡"></a>æ¶æ„è®¾è®¡</h3><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs xl">å¼€å‘æµç¨‹ï¼šM<span class="hljs-function"><span class="hljs-title">arkdown</span> -&gt;</span> H<span class="hljs-function"><span class="hljs-title">exo</span> -&gt;</span> HTML -&gt; GitHub Pages<br>éƒ¨ç½²æµç¨‹ï¼šG<span class="hljs-function"><span class="hljs-title">it</span> Push -&gt;</span> A<span class="hljs-function"><span class="hljs-title">ctions</span> -&gt;</span> B<span class="hljs-function"><span class="hljs-title"><code class="language-hljs xl">å¼€å‘æµç¨‹ï¼šM<span class="hljs-function"><span class="hljs-title">arkdown</span> -&gt;</span> H<span class="hljs-function"><span class="hljs-title">exo</span> -&gt;</span> HTML -&gt; GitHub Pages<br>éƒ¨ç½²æµç¨‹ï¼šG<span class="hljs-function"><span class="hljs-title">it</span> Push -&gt;</span> A<span class="hljs-function"><span class="hljs-title">ctions</span> -&gt;</span> B<span class="hljs-function"><span class="hljs-title">uild</span> -></span> Deploy<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="å®ç°æ–¹æ¡ˆ"><a href="#å®ç°æ–¹æ¡ˆ" class="headerlink" title="å®ç°æ–¹æ¡ˆ"></a>å®ç°æ–¹æ¡ˆ</h2><h3 id="é‡æ„æ–¹æ¡ˆ"><a href="#é‡æ„æ–¹æ¡ˆ" class="headerlink" title="é‡æ„æ–¹æ¡ˆ"></a>é‡æ„æ–¹æ¡ˆ</h3><p>æŒ‰ç…§æ–°çš„æ¨¡æ¿è¦æ±‚ï¼Œåšå®¢é‡æ„åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ol><li><strong>ç›®å½•ç»“æ„æ ‡å‡†åŒ–</strong></li><li><strong>é…ç½®æ–‡ä»¶è§„èŒƒåŒ–</strong></li><li><strong>CI&#x2F;CD è‡ªåŠ¨åŒ–</strong></li><li><strong>æ–‡ç« æ¨¡æ¿ç»Ÿä¸€åŒ–</strong></li></ol><h3 id="æŠ€æœ¯å‡çº§"><a href="#æŠ€æœ¯å‡çº§" class="headerlink" title="æŠ€æœ¯å‡çº§"></a>æŠ€æœ¯å‡çº§</h3><ul><li>Hexo ç‰ˆæœ¬å‡çº§åˆ°æœ€æ–°ç¨³å®šç‰ˆ</li><li>ä¸»é¢˜åˆ‡æ¢åˆ° Butterfly</li><li>æ·»åŠ æ›´å¤šå®ç”¨æ’ä»¶</li><li>å®Œå–„è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹</li></ul><h2 id="æ ¸å¿ƒä»£ç "><a href="#æ ¸å¿ƒä»£ç " class="headerlink" title="æ ¸å¿ƒä»£ç "></a>æ ¸å¿ƒä»£ç </h2><h4 id="æ–°çš„é…ç½®æ–‡ä»¶"><a href="#æ–°çš„é…ç½®æ–‡ä»¶" class="headerlink" title="æ–°çš„é…ç½®æ–‡ä»¶"></a>æ–°çš„é…ç½®æ–‡ä»¶</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs yaml"><span class="hljs-comment"># _config.yml</span><br><span class="hljs-attr">theme:</span> <span class="hljs-string">butterfly</span><br><span class="hljs-attr">url:</span> <span class="hljs-string">https://1019350030wfj.github.io</span><br><span class="hljs-attr">post_asset_folder:</span> <span class="hljs-literal"><code class="language-hljs yaml"><span class="hljs-comment"># _config.yml</span><br><span class="hljs-attr">theme:</span> <span class="hljs-string">butterfly</span><br><span class="hljs-attr">url:</span> <span class="hljs-string">https://1019350030wfj.github.io</span><br><span class="hljs-attr">post_asset_folder:</span> <span class="hljs-literal">true</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h4 id="GitHub-Actions-å·¥ä½œæµ"><a href="#GitHub-Actions-å·¥ä½œæµ" class="headerlink" title="GitHub Actions å·¥ä½œæµ"></a>GitHub Actions å·¥ä½œæµ</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">Hexo</span> <span class="hljs-string">Tech</span> <span class="hljs-string">Blog</span><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span> [<span class="hljs-string">main</span>]<br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">build:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v4</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">node-version:</span> <span class="hljs-number">18</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npx</span> <span class="hljs-string">hexo</span> <span class="hljs-string">clean</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">npx</span> <span class="hljs-string">hexo</span> <span class="hljs-string">generate</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">peaceiris/actions-gh-pages@v3</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">github_token:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.GITHUB_TOKEN</span> <span class="hljs-string">&#125;&#125;</span><br>          <span class="hljs-attr">publish_dir:</span> <span class="hljs-string"><code class="language-hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">Hexo</span> <span class="hljs-string">Tech</span> <span class="hljs-string">Blog</span><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span> [<span class="hljs-string">main</span>]<br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">build:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v4</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">node-version:</span> <span class="hljs-number">18</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npx</span> <span class="hljs-string">hexo</span> <span class="hljs-string">clean</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">npx</span> <span class="hljs-string">hexo</span> <span class="hljs-string">generate</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">peaceiris/actions-gh-pages@v3</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">github_token:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.GITHUB_TOKEN</span> <span class="hljs-string">&#125;&#125;</span><br>          <span class="hljs-attr">publish_dir:</span> <span class="hljs-string">./public</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure><h2 id="å¸¸è§å‘"><a href="#å¸¸è§å‘" class="headerlink" title="å¸¸è§å‘"></a>å¸¸è§å‘</h2><h3 id="1-éƒ¨ç½²å¤±è´¥"><a href="#1-éƒ¨ç½²å¤±è´¥" class="headerlink" title="1. éƒ¨ç½²å¤±è´¥"></a>1. éƒ¨ç½²å¤±è´¥</h3><p><strong>é—®é¢˜</strong>ï¼šGitHub Actions éƒ¨ç½²æ—¶å‡ºç°æƒé™é”™è¯¯ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li>ç¡®ä¿ <code>github_token</code> æ­£ç¡®é…ç½®</li><li>æ£€æŸ¥åˆ†æ”¯æƒé™è®¾ç½®</li><li>éªŒè¯ Actions å·¥ä½œæµè¯­æ³•</li></ul><h3 id="2-ä¸»é¢˜æ¸²æŸ“å¼‚å¸¸"><a href="#2-ä¸»é¢˜æ¸²æŸ“å¼‚å¸¸" class="headerlink" title="2. ä¸»é¢˜æ¸²æŸ“å¼‚å¸¸"></a>2. ä¸»é¢˜æ¸²æŸ“å¼‚å¸¸</h3><p><strong>é—®é¢˜</strong>ï¼šåˆ‡æ¢ä¸»é¢˜åé¡µé¢æ˜¾ç¤ºå¼‚å¸¸ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li>æ¸…ç†ç¼“å­˜ï¼š<code>hexo clean</code></li><li>é‡æ–°å®‰è£…ä¾èµ–ï¼š<code>npm install</code></li><li>æ£€æŸ¥ä¸»é¢˜å…¼å®¹æ€§</li></ul><h3 id="3-å›¾ç‰‡è·¯å¾„é”™è¯¯"><a href="#3-å›¾ç‰‡è·¯å¾„é”™è¯¯" class="headerlink" title="3. å›¾ç‰‡è·¯å¾„é”™è¯¯"></a>3. å›¾ç‰‡è·¯å¾„é”™è¯¯</h3><p><strong>é—®é¢˜</strong>ï¼šæ–‡ç« ä¸­å›¾ç‰‡æ— æ³•æ­£å¸¸æ˜¾ç¤ºã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li>å¼€å¯ <code>post_asset_folder: true</code></li><li>å°†å›¾ç‰‡æ”¾åœ¨åŒåæ–‡ä»¶å¤¹ä¸‹</li><li>ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¼•ç”¨</li></ul><h2 id="å¯è¿ç§»ç»éªŒ"><a href="#å¯è¿ç§»ç»éªŒ" class="headerlink" title="å¯è¿ç§»ç»éªŒ"></a>å¯è¿ç§»ç»éªŒ</h2><ol><li><strong>ç‰ˆæœ¬æ§åˆ¶çš„é‡è¦æ€§</strong>ï¼šæ‰€æœ‰å†…å®¹éƒ½çº³å…¥ç‰ˆæœ¬æ§åˆ¶ï¼Œä¾¿äºè¿½è¸ªå’Œå›æ»š</li><li><strong>è‡ªåŠ¨åŒ–æ€ç»´</strong>ï¼šå°½å¯èƒ½è‡ªåŠ¨åŒ–é‡å¤æ€§å·¥ä½œ</li><li><strong>æ–‡æ¡£å…ˆè¡Œ</strong>ï¼šå®Œå–„çš„é¡¹ç›®æ–‡æ¡£èƒ½å‡å°‘å¾ˆå¤šæ²Ÿé€šæˆæœ¬</li><li><strong>æ¸è¿›å¼æ”¹è¿›</strong>ï¼šé‡æ„ä¸éœ€è¦ä¸€æ­¥åˆ°ä½ï¼Œå¯ä»¥é€æ­¥æ”¹è¿›</li></ol><h2 id="æœªæ¥è§„åˆ’"><a href="#æœªæ¥è§„åˆ’" class="headerlink" title="æœªæ¥è§„åˆ’"></a>æœªæ¥è§„åˆ’</h2><ol><li><strong>å†…å®¹è§„åˆ’</strong>ï¼šæ¯æœˆ2ç¯‡æ·±åº¦æŠ€æœ¯æ–‡ç« </li><li><strong>æŠ€æœ¯æ–¹å‘</strong>ï¼šé‡ç‚¹åœ¨ Android æ€§èƒ½ä¼˜åŒ–å’Œ C++ å¼€å‘</li><li><strong>ç”Ÿæ€å»ºè®¾</strong>ï¼šå»ºç«‹æŠ€æœ¯äº¤æµç¾¤ï¼Œç»„ç»‡æŠ€æœ¯åˆ†äº«</li><li><strong>å·¥å…·é“¾å®Œå–„</strong>ï¼šé›†æˆæ›´å¤šå¼€å‘å·¥å…·</li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä» 2016 å¹´çš„ Hello World å¼€å§‹ï¼Œè¿™ä¸ªæŠ€æœ¯åšå®¢è§è¯äº†æˆ‘çš„æŠ€æœ¯æˆé•¿å†ç¨‹ã€‚ç°åœ¨çš„é‡æ„ï¼Œè®©åšå®¢æ›´åŠ å·¥ç¨‹åŒ–ã€æ ‡å‡†åŒ–ï¼Œä¸ºæœªæ¥çš„æŠ€æœ¯æ²‰æ·€å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚</p><blockquote><p>æŠ€æœ¯ä¹‹è·¯ï¼Œæ°¸æ— æ­¢å¢ƒã€‚æ„¿ä¸å„ä½åŒè¡Œè€…ä¸€èµ·ï¼Œåœ¨æŠ€æœ¯çš„é“è·¯ä¸Šä¸æ–­å‰è¡Œã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Engineering</category>
      
      <category>åšå®¢å»ºè®¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>GitHub Pages</tag>
      
      <tag>é™æ€åšå®¢</tag>
      
      <tag>å¼€æº</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
